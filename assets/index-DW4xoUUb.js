import{_ as g,s as w,c as u,b as o,a as e,t as v,w as f,i as _,F as k,k as y,r as c,o as h,h as m}from"./index-bZBJiZFm.js";document.title="會員中心";const V={data(){return{dinnerCount:0,renameInvalid:!1,password:{old:"",new:"",doubleCheck:""},isLoading:!1}},emits:["updateProfile"],computed:{user(){if(this.memberData.email){const{email:i,nickname:s}=this.memberData;return{email:i,nickname:s}}else return{}},...w(y,["memberData"])},methods:{getProfile(){this.isLoading=!0,this.axios.get(`https://whatstoday2024-8nsu.onrender.com/600/records?userId=${this.memberData.id}`,{headers:{authorization:this.$cookie.getMemberToken()}}).then(i=>{const s=i.data.message.length;s&&(this.dinnerCount=s),this.isLoading=!1}).catch(()=>{this.isLoading=!1})},editProfile(){if(this.user.nickname===this.memberData.nickname){this.renameInvalid=!0;return}this.isLoading=!0,this.axios.patch(`https://whatstoday2024-8nsu.onrender.com/600/users/${this.memberData.id}`,{nickname:this.user.nickname},{headers:{authorization:this.$cookie.getMemberToken()}}).then(()=>{this.$emit("updateProfile",{status:"success",message:"會員名稱修改成功"}),this.isLoading=!1}).catch(()=>{this.$emit("updateProfile",{status:"error",message:"會員名稱修改失敗"}),this.isLoading=!1})},async changePassword(){this.isLoading=!0,await this.checkPassword()?this.axios.patch(`https://whatstoday2024-8nsu.onrender.com/600/users/${this.memberData.id}`,{password:this.password.new},{headers:{authorization:this.$cookie.getMemberToken()}}).then(()=>{this.$emit("updateProfile",{status:"success",message:"密碼修改成功"})}).catch(()=>{this.$emit("updateProfile",{status:"error",message:"密碼修改失敗"}),this.isLoading=!1}):(this.$emit("updateProfile",{status:"error",message:"舊密碼輸入不正確"}),this.isLoading=!1)},checkPassword(){const i={email:this.user.email,password:this.password.old};return new Promise(s=>{this.axios.post("https://whatstoday2024-8nsu.onrender.com/login",i).then(()=>{s(!0)}).catch(()=>{s(!1)})})}},mounted(){this.getProfile()}},P={class:"flex-fill d-flex align-items-center"},x={class:"container pb-5"},C=e("h2",{class:"text-center my-3"},"個人資料總覽",-1),L={key:0,class:"row g-4"},D={class:"col-12"},z={class:"border border-primary rounded-4 p-5 text-center"},I={class:"mb-0",style:{"font-size":"8rem","line-height":"0.8"}},S=e("h5",{class:"fs-4 fw-normal mt-4 mb-0 text-muted"},"累積產生的便當數",-1),F={class:"col-lg-6"},M={class:"border border-primary rounded-4 p-5 h-100"},U=e("h5",{class:"mb-4 fs-4"},"會員資料",-1),q={class:"form-floating mb-4"},B=["value"],E=e("label",null,"帳號",-1),N={class:"form-floating mb-4"},T={key:0,class:"text-danger mb-0 mt-2",style:{"font-size":"0.875rem"}},$=e("label",{for:"username"},"暱稱",-1),j=e("div",{class:"text-end mt-4"},[e("button",{type:"submit",class:"btn btn-primary btn-lg rounded-pill"},"修改資料")],-1),A={class:"col-lg-6"},G={class:"border border-primary rounded-4 p-5 h-100"},H=e("h5",{class:"mb-4 fs-4"},"修改密碼",-1),J={class:"form-floating mb-4"},K=e("label",{for:"oldPassword"},"請輸入舊密碼",-1),O={class:"form-floating mb-4"},Q=e("label",{for:"newPassword"},"請輸入新密碼",-1),R={class:"form-floating mb-4"},W=e("label",{for:"newPasswordDoubleCheck"},"再次確認新密碼",-1),X=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-primary btn-lg rounded-pill"},"修改密碼")],-1);function Y(i,s,Z,ee,t,n){const b=c("loadingVue"),r=c("VField"),d=c("ErrorMessage"),p=c("VForm");return h(),u(k,null,[o(b,{active:t.isLoading},null,8,["active"]),e("div",P,[e("div",x,[C,n.user.email?(h(),u("div",L,[e("div",D,[e("div",z,[e("p",I,v(t.dinnerCount),1),S])]),e("div",F,[e("div",M,[U,e("div",q,[e("input",{type:"email",class:"form-control",value:n.user.email,disabled:"",title:"會員帳號不得修改"},null,8,B),E]),o(p,{onSubmit:n.editProfile},{default:f(({errors:l})=>[e("div",N,[o(r,{type:"text",id:"username",placeholder:"暱稱",name:"暱稱",class:m(["form-control",{"is-invalid":l.暱稱||t.renameInvalid}]),rules:"required",modelValue:n.user.nickname,"onUpdate:modelValue":s[0]||(s[0]=a=>n.user.nickname=a),onInput:s[1]||(s[1]=a=>t.renameInvalid=!1)},null,8,["class","modelValue"]),o(d,{name:"暱稱",class:"invalid-feedback",style:{"font-size":"0.875rem"}}),t.renameInvalid?(h(),u("p",T,"新名稱與舊名稱相同")):_("",!0),$]),j]),_:1},8,["onSubmit"])])]),e("div",A,[e("div",G,[H,o(p,{onSubmit:n.changePassword},{default:f(({errors:l})=>[e("div",J,[o(r,{type:"password",id:"oldPassword",placeholder:"請輸入舊密碼",name:"舊密碼",class:m(["form-control",{"is-invalid":l.舊密碼}]),rules:"required",modelValue:t.password.old,"onUpdate:modelValue":s[2]||(s[2]=a=>t.password.old=a)},null,8,["class","modelValue"]),o(d,{name:"舊密碼",class:"invalid-feedback"}),K]),e("div",O,[o(r,{type:"password",id:"newPassword",placeholder:"請輸入新密碼",name:"新密碼",class:m(["form-control",{"is-invalid":l.新密碼}]),rules:"min:4|is_not:@舊密碼",modelValue:t.password.new,"onUpdate:modelValue":s[3]||(s[3]=a=>t.password.new=a)},null,8,["class","modelValue"]),o(d,{name:"新密碼",class:"invalid-feedback"}),Q]),e("div",R,[o(r,{type:"password",id:"newPasswordDoubleCheck",placeholder:"再次確認新密碼",name:"確認新密碼",class:m(["form-control",{"is-invalid":l.確認新密碼}]),rules:"required|confirmed:@新密碼",modelValue:t.password.doubleCheck,"onUpdate:modelValue":s[4]||(s[4]=a=>t.password.doubleCheck=a)},null,8,["class","modelValue"]),o(d,{name:"確認新密碼",class:"invalid-feedback"}),W]),X]),_:1},8,["onSubmit"])])])])):_("",!0)])])],64)}const te=g(V,[["render",Y]]);export{te as default};
