import{M as r}from"./modal-B50nF2Dk.js";import{_ as L,j as c,o as b,c as m,a as e,t as n,i as h,l as P,x as j,h as B,F as U,p as I,e as q}from"./index-JGpVG-b7.js";const F={props:["bentoTemp","generateBento","memberData","deleteFromCalendar"],data(){return{path:"",bentoModal:null,saveToBentoDiaryModal:null,confirmRegenerateModal:null,confirmDeleteRecordModal:null,bentoDate:new Date().toISOString().slice(0,10),mealType:"午餐",bentoRecords:[],successDelay:1500,errorDelay:2e3}},methods:{async getBentoRecords(){try{const l=await this.axios.get(`https://whatstoday2024-8nsu.onrender.com/600/users/${this.memberData.id}/records/`);this.bentoRecords=l.data.message}catch{this.errorProcess()}},async saveToDiary(){await this.getBentoRecords();const l={...this.bentoTemp,date:this.bentoDate,mealType:this.mealType},t=this.bentoRecords.find(o=>o.date===l.date&&o.mealType===l.mealType);if(t){if(confirm("該時段已有便當紀錄，請問是否決定覆蓋該紀錄？"))try{await this.axios.patch(`https://whatstoday2024-8nsu.onrender.com/600/records/${t.id}`,l),c.success("紀錄已存至便當日記！",{autoClose:this.successDelay})}catch{this.errorProcess()}}else try{await this.axios.post(`https://whatstoday2024-8nsu.onrender.com/600/users/${this.memberData.id}/records/`,l),c.success("紀錄已存至便當日記！",{autoClose:this.successDelay})}catch{this.errorProcess()}this.saveToBentoDiaryModal.hide()},async deleteRecord(){try{await this.axios.delete(`https://whatstoday2024-8nsu.onrender.com/600/records/${this.bentoTemp.idTemp}`),c.success("便當紀錄刪除成功！",{autoClose:this.successDelay}),this.deleteFromCalendar()}catch{this.errorProcess()}this.confirmDeleteRecordModal.hide()},errorProcess(){c.error("發生了某些錯誤，將重新整理頁面。",{autoClose:this.errorDelay}),setTimeout(()=>{location.reload()},this.errorDelay)},openModal(l){this.hideModal(),l.show()},hideModal(){this.bentoModal.hide(),this.saveToBentoDiaryModal.hide(),this.confirmRegenerateModal.hide(),this.confirmDeleteRecordModal.hide()},init(){this.path=this.$route.path,this.bentoModal=new r(document.querySelector("#bentoModal")),this.saveToBentoDiaryModal=new r(document.querySelector("#saveToBentoDiaryModal")),this.confirmRegenerateModal=new r(document.querySelector("#confirmRegenerateModal")),this.confirmDeleteRecordModal=new r(document.querySelector("#confirmDeleteRecordModal"))}},mounted(){this.init()}},i=l=>(I("data-v-0c87d361"),l=l(),q(),l),V={class:"modal fade",id:"bentoModal",tabindex:"-1","aria-labelledby":"bentoModalLabel","aria-hidden":"true"},N={class:"modal-dialog modal-lg modal-dialog-centered"},z={class:"modal-content bento"},E={class:"modal-header px-4"},O=i(()=>e("h3",{class:"modal-title",id:"bentoModalLabel"},"今天吃什麼？",-1)),A={class:"modal-body row m-0 row-cols-1 row-cols-lg-2"},G={class:"bento-description col-lg-4 order-last order-lg-1 row m-0 p-lg-3"},H={class:"nutrition-portion p-3 col-6 col-lg-12"},J=i(()=>e("h4",{class:"mb-3 lh-base"},"營養比例：",-1)),K={class:"row row-cols-1"},Q={class:"col row row-cols-2"},W=i(()=>e("div",{class:"col"},[e("p",{class:"m-0"},"澱粉")],-1)),X={class:"col"},Y={class:"m-0 text-end"},Z={class:"col row row-cols-2"},$=i(()=>e("div",{class:"col"},[e("p",{class:"m-0"},"蛋白質")],-1)),ee={class:"col"},te={class:"m-0 text-end"},oe={class:"col row row-cols-2"},se=i(()=>e("div",{class:"col"},[e("p",{class:"m-0"},"蔬菜")],-1)),ae={class:"col"},le={class:"m-0 text-end"},de={key:0,class:"btns text-center p-3 col-6 col-lg-12"},ie=["title","disabled"],ne={key:0,class:"d-block text-danger"},re={key:1,class:"btns text-center p-3 col-6 col-lg-12"},ce={class:"bento-presentation col-lg-8 order-first order-lg-2"},be={class:"border border-gray border-3 rounded w-100 h-100 p-3 pb-4"},me={class:"row g-2 h-100"},he={class:"col col-4 h-50"},ue={class:"side-dish border border-gray border-3 rounded h-100"},_e=["src","alt","title"],ye={class:"col col-4 h-50"},ve={class:"side-dish border border-gray border-3 rounded h-100"},pe=["src","alt","title"],ge={class:"col col-4 h-50"},Me={class:"side-dish border border-gray border-3 rounded h-100"},Te=["src","alt","title"],De={class:"col col-12 h-50"},fe={class:"border border-gray border-3 rounded col-12 h-100 p-0 d-flex"},Ce={class:"staple w-50"},we=["src","alt","title"],Re={class:"entree w-50"},xe=["src","alt","title"],ke={class:"modal fade",id:"confirmRegenerateModal","data-bs-backdrop":"static",tabindex:"-1","aria-labelledby":"confirmRegenerateModalLabel","aria-hidden":"true"},Be={class:"modal-dialog modal-dialog-centered"},Se={class:"modal-content"},Le={class:"modal-header"},Pe=i(()=>e("h5",{class:"modal-title",id:"confirmRegenerateModalLabel"},"是否確認重新生成新的便當？",-1)),je=i(()=>e("div",{class:"modal-body"}," 此操作將無法復原，請確認是否執行。 ",-1)),Ue={class:"modal-footer"},Ie={class:"modal fade",id:"saveToBentoDiaryModal","data-bs-backdrop":"static",tabindex:"-1","aria-labelledby":"saveToBentoDiaryModalLabel","aria-hidden":"true"},qe={class:"modal-dialog modal-dialog-centered"},Fe={class:"modal-content"},Ve={class:"modal-header"},Ne=i(()=>e("h5",{class:"modal-title",id:"saveToBentoDiaryModalLabel"},"存至便當日記",-1)),ze={class:"modal-body"},Ee={class:"mb-3"},Oe=i(()=>e("label",{class:"mx-2",for:"bentoDate"},"便當日記：",-1)),Ae=i(()=>e("label",{class:"mx-2",for:"mealType"},"這是我的：",-1)),Ge={class:"btn-group",role:"group","aria-label":"Basic outlined example"},He={class:"modal-footer"},Je={class:"modal fade",id:"confirmDeleteRecordModal","data-bs-backdrop":"static",tabindex:"-1","aria-labelledby":"confirmDeleteRecordModalLabel","aria-hidden":"true"},Ke={class:"modal-dialog modal-dialog-centered"},Qe={class:"modal-content"},We={class:"modal-header"},Xe=i(()=>e("h5",{class:"modal-title",id:"confirmDeleteRecordModalLabel"},"是否確認刪除此便當紀錄？",-1)),Ye=i(()=>e("div",{class:"modal-body"}," 此操作將無法復原，請確認是否執行。 ",-1)),Ze={class:"modal-footer"};function $e(l,t,o,S,a,d){var u,_,y,v,p,g,M,T,D,f,C,w,R,x,k;return b(),m(U,null,[e("div",V,[e("div",N,[e("div",z,[e("div",E,[O,e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=(...s)=>d.hideModal&&d.hideModal(...s))})]),e("div",A,[e("div",G,[e("div",H,[J,e("div",K,[e("div",Q,[W,e("div",X,[e("p",Y,n(Math.round(o.bentoTemp.starchTotalPortion/4*100)/100)+" 碗",1)])]),e("div",Z,[$,e("div",ee,[e("p",te,n(o.bentoTemp.proteinTotalPortion)+" 份",1)])]),e("div",oe,[se,e("div",ae,[e("p",le,n(o.bentoTemp.vegetableTotalPortion)+" 份",1)])])])]),a.path==="/menu"?(b(),m("div",de,[e("button",{type:"button",class:"btn btn-outline-primary re-generate-btn px-4 py-3 m-2","data-bs-dismiss":"modal",onClick:t[1]||(t[1]=s=>d.openModal(a.confirmRegenerateModal)),title:"重新生成便當"},"重新生成便當"),e("button",{type:"button",class:"btn btn-primary save-to-diary-btn px-4 py-3 m-2","data-bs-dismiss":"modal",onClick:t[2]||(t[2]=s=>d.openModal(a.saveToBentoDiaryModal)),title:o.memberData.id?"存至便當日記":"便當日記為會員限定功能",disabled:!o.memberData.id},"存至便當日記",8,ie),o.memberData.id?h("",!0):(b(),m("small",ne,"* 登入以享 便當日記 相關功能"))])):h("",!0),a.path==="/member/bento-diary"?(b(),m("div",re,[e("p",null,n(o.bentoTemp.dateTemp),1),e("p",null,n(o.bentoTemp.mealType),1),e("button",{type:"button",class:"btn btn-outline-primary re-generate-btn px-4 py-3 m-2","data-bs-dismiss":"modal",onClick:t[3]||(t[3]=s=>d.openModal(a.confirmDeleteRecordModal)),title:"刪除此便當紀錄"},"刪除此便當紀錄")])):h("",!0)]),e("div",ce,[e("div",be,[e("div",me,[e("div",he,[e("div",ue,[e("img",{class:"img rounded object-fit-cover h-100",src:(u=o.bentoTemp.sideDishes[0])==null?void 0:u.imgUrl,alt:((_=o.bentoTemp.sideDishes[0])==null?void 0:_.title)+"的圖片",title:(y=o.bentoTemp.sideDishes[0])==null?void 0:y.title},null,8,_e)])]),e("div",ye,[e("div",ve,[e("img",{class:"img rounded object-fit-cover h-100",src:(v=o.bentoTemp.sideDishes[1])==null?void 0:v.imgUrl,alt:((p=o.bentoTemp.sideDishes[1])==null?void 0:p.title)+"的圖片",title:(g=o.bentoTemp.sideDishes[1])==null?void 0:g.title},null,8,pe)])]),e("div",ge,[e("div",Me,[e("img",{class:"img rounded object-fit-cover h-100",src:(M=o.bentoTemp.sideDishes[2])==null?void 0:M.imgUrl,alt:((T=o.bentoTemp.sideDishes[2])==null?void 0:T.title)+"的圖片",title:(D=o.bentoTemp.sideDishes[2])==null?void 0:D.title},null,8,Te)])]),e("div",De,[e("div",fe,[e("div",Ce,[e("img",{class:"img img-fluid object-fit-cover h-100",src:(f=o.bentoTemp.stapleCourse)==null?void 0:f.imgUrl,alt:((C=o.bentoTemp.stapleCourse)==null?void 0:C.title)+"的圖片",title:(w=o.bentoTemp.stapleCourse)==null?void 0:w.title},null,8,we)]),e("div",Re,[e("img",{class:"img img-fluid object-fit-cover h-100",src:(R=o.bentoTemp.mainCourse)==null?void 0:R.imgUrl,alt:((x=o.bentoTemp.mainCourse)==null?void 0:x.title)+"的圖片",title:(k=o.bentoTemp.mainCourse)==null?void 0:k.title},null,8,xe)])])])])])])])])])]),e("div",ke,[e("div",Be,[e("div",Se,[e("div",Le,[Pe,e("button",{type:"button",class:"btn-close","aria-label":"Cancel and Return","data-bs-dismiss":"modal",onClick:t[4]||(t[4]=s=>d.openModal(a.bentoModal))})]),je,e("div",Ue,[e("button",{type:"button",class:"btn btn-secondary","aria-label":"Cancel and Return","data-bs-dismiss":"modal",onClick:t[5]||(t[5]=s=>d.openModal(a.bentoModal))},"取消"),e("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:t[6]||(t[6]=(...s)=>o.generateBento&&o.generateBento(...s))},"確認")])])])]),e("div",Ie,[e("div",qe,[e("div",Fe,[e("div",Ve,[Ne,e("button",{type:"button",class:"btn-close","aria-label":"Cancel and Return","data-bs-dismiss":"modal",onClick:t[7]||(t[7]=s=>d.openModal(a.bentoModal))})]),e("div",ze,[e("div",Ee,[Oe,P(e("input",{class:"form-control me-4 w-auto d-inline-block",id:"bentoDate",type:"date","onUpdate:modelValue":t[8]||(t[8]=s=>a.bentoDate=s)},null,512),[[j,a.bentoDate]])]),e("div",null,[Ae,e("div",Ge,[e("button",{type:"button",class:B(["lunch-btn btn btn-outline-primary px-2 py-1",{active:a.mealType==="午餐"}]),onClick:t[9]||(t[9]=s=>a.mealType="午餐")},"午餐",2),e("button",{type:"button",class:B(["dinner-btn btn btn-outline-primary px-2 py-1",{active:a.mealType==="晚餐"}]),onClick:t[10]||(t[10]=s=>a.mealType="晚餐")},"晚餐",2)])])]),e("div",He,[e("button",{type:"button",class:"btn btn-secondary","aria-label":"Cancel and Return","data-bs-dismiss":"modal",onClick:t[11]||(t[11]=s=>d.openModal(a.bentoModal))},"取消"),e("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:t[12]||(t[12]=(...s)=>d.saveToDiary&&d.saveToDiary(...s))},"確認儲存")])])])]),e("div",Je,[e("div",Ke,[e("div",Qe,[e("div",We,[Xe,e("button",{type:"button",class:"btn-close","aria-label":"Cancel and Return","data-bs-dismiss":"modal",onClick:t[13]||(t[13]=s=>d.openModal(a.bentoModal))})]),Ye,e("div",Ze,[e("button",{type:"button",class:"btn btn-secondary","aria-label":"Cancel and Return","data-bs-dismiss":"modal",onClick:t[14]||(t[14]=s=>d.openModal(a.bentoModal))},"取消"),e("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:t[15]||(t[15]=(...s)=>d.deleteRecord&&d.deleteRecord(...s))},"確認")])])])])],64)}const ot=L(F,[["render",$e],["__scopeId","data-v-0c87d361"]]);export{ot as B};
