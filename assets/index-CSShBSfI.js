import{_ as k,o as h,c as m,F as x,g as W,a as e,t as b,h as v,l as y,v as q,q as C,p as B,e as S,d as T,s as G,u as E,j as w,m as H,x as J,b as D,i as g,k as O,r as z}from"./index-CUy6xNXa.js";const K={props:["dishesList","mode","modalName","updateSelected","updatePreferenceLevel"],data(){return{dishInfo:{}}},methods:{},mounted(){}},_=t=>(B("data-v-1dfd1ba8"),t=t(),S(),t),Q={key:0,class:"cards row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-4"},X={class:"card h-100"},Y=["src","alt"],Z={class:"card-body dish-info mx-auto px-0 py-3 w-80 d-flex flex-column justify-content-between"},ee=["onClick"],te=["data-bs-target"],se={class:"card-title text-center"},oe={class:"card-eng-title mb-3 d-block text-center"},ie={class:"input-group mx-auto"},le=["onUpdate:modelValue","onChange","disabled"],ae=["onUpdate:modelValue","onChange","disabled"],de=T('<option value="1" selected data-v-1dfd1ba8>1</option><option value="2" data-v-1dfd1ba8>2</option><option value="3" data-v-1dfd1ba8>3</option><option value="4" data-v-1dfd1ba8>4</option><option value="5" data-v-1dfd1ba8>5</option>',5),ne=[de],ce={key:1,class:"mx-2"},re=_(()=>e("h5",null,"沒有找到對應的菜色",-1)),he=[re],me=["id"],be={class:"modal-dialog modal-lg modal-dialog-centered"},pe={class:"modal-content dish"},_e=_(()=>e("div",{class:"modal-header px-4"},[e("h3",{class:"modal-title",id:"dishModalLabel"},"菜色介紹"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),ue={class:"modal-body"},ve={class:"row row-cols-1 row-cols-lg-2"},fe={class:"col order-last order-lg-1 row row-cols-1 gap-3 mt-0 py-3 px-0 mx-auto justify-content-center"},ge={class:"col row align-items-start"},ye=_(()=>e("div",{class:"col"},[e("h6",{class:"m-0 lh-base"},"中文菜名：")],-1)),Le={class:"col"},we={class:"m-0"},De={class:"col row align-items-start"},xe=_(()=>e("div",{class:"col"},[e("h6",{class:"m-0 lh-base"},"英文菜名：")],-1)),Te={class:"col"},Ce={class:"m-0"},ke={class:"col row align-items-center"},Be=_(()=>e("div",{class:"col"},[e("h6",{class:"m-0 lh-base"},"喜好程度：")],-1)),Se={class:"col"},$e=["disabled"],Ie=T('<option value="1" data-v-1dfd1ba8>1</option><option value="2" data-v-1dfd1ba8>2</option><option value="3" data-v-1dfd1ba8>3</option><option value="4" data-v-1dfd1ba8>4</option><option value="5" data-v-1dfd1ba8>5</option>',5),Me=[Ie],Ue={class:"col row align-items-start"},Pe=_(()=>e("div",{class:"col"},[e("h6",{class:"m-0 lh-base"},"健康推薦指數：")],-1)),je={class:"col"},Ve={class:"m-0"},Re={class:"col row align-items-start"},Ne=_(()=>e("div",{class:"col"},[e("h6",{class:"m-0 lh-base"},"營養比例：")],-1)),Fe={class:"col"},Ae={class:"row row-cols-1 justify-content-between"},Oe={class:"col d-flex"},ze=_(()=>e("div",{class:"w-50"},[e("p",{class:"m-0"},"澱粉")],-1)),Ge={class:"w-50"},We={class:"m-0 text-end"},qe={class:"col d-flex"},Ee=_(()=>e("div",{class:"w-50"},[e("p",{class:"m-0"},"蛋白質")],-1)),He={class:"w-50"},Je={class:"m-0 text-end"},Ke={class:"col d-flex"},Qe=_(()=>e("div",{class:"w-50"},[e("p",{class:"m-0"},"蔬菜")],-1)),Xe={class:"w-50"},Ye={class:"m-0 text-end"},Ze={class:"col col-lg-5 col-8 p-3 order-first order-lg-2 mx-auto align-self-center"},et=["src"];function tt(t,s,i,d,o,l){return h(),m(x,null,[i.dishesList.length!==0?(h(),m("div",Q,[(h(!0),m(x,null,W(i.dishesList,a=>(h(),m("div",{class:"col",key:a.title},[e("div",X,[e("img",{src:a.imgUrl,height:"120rem",class:"card-img-top object-fit-cover",alt:a.title+"的圖片"},null,8,Y),e("div",Z,[e("div",{class:"dish-info-btn btn p-0 d-flex",onClick:r=>o.dishInfo=a},[e("i",{class:"fa-solid fa-circle-info text-secondary fs-5 lh-sm",title:"菜色介紹","data-bs-toggle":"modal","data-bs-target":"#"+i.modalName},null,8,te)],8,ee),e("h5",se,b(a.title),1),e("small",oe,b(a.engTitle),1),e("div",ie,[e("div",{class:v(["input-group-text",{"bg-grey9F":i.mode==="default"}])},[y(e("input",{class:"form-check-input mt-0",type:"checkbox","aria-label":"Checkbox for following text input","onUpdate:modelValue":r=>a.isChecked=r,onChange:r=>i.updateSelected(a),disabled:i.mode==="default"},null,40,le),[[q,a.isChecked]])],2),y(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":r=>a.preferenceLevel=r,onChange:r=>i.updatePreferenceLevel(a),disabled:!a.isChecked||i.mode==="default"},ne,40,ae),[[C,a.preferenceLevel]])])])])]))),128))])):(h(),m("div",ce,he)),e("div",{class:"modal fade",id:i.modalName,tabindex:"-1","aria-labelledby":"dishModalLabel","aria-hidden":"true"},[e("div",be,[e("div",pe,[_e,e("div",ue,[e("div",ve,[e("div",fe,[e("div",ge,[ye,e("div",Le,[e("p",we,b(o.dishInfo.title),1)])]),e("div",De,[xe,e("div",Te,[e("p",Ce,b(o.dishInfo.engTitle),1)])]),e("div",ke,[Be,e("div",Se,[y(e("select",{class:"form-select w-75","aria-label":"Default select example",disabled:!o.dishInfo.isChecked,"onUpdate:modelValue":s[0]||(s[0]=a=>o.dishInfo.preferenceLevel=a)},Me,8,$e),[[C,o.dishInfo.preferenceLevel]])])]),e("div",Ue,[Pe,e("div",je,[e("p",Ve,b(o.dishInfo.healthLevel),1)])]),e("div",Re,[Ne,e("div",Fe,[e("div",Ae,[e("div",Oe,[ze,e("div",Ge,[e("p",We,b(o.dishInfo.starchPortion/4)+" 碗",1)])]),e("div",qe,[Ee,e("div",He,[e("p",Je,b(o.dishInfo.proteinPortion)+" 份",1)])]),e("div",Ke,[Qe,e("div",Xe,[e("p",Ye,b(o.dishInfo.vegetablePortion)+" 份",1)])])])])])]),e("div",Ze,[e("img",{class:"object-fit-cover",src:o.dishInfo.imgUrl,alt:""},null,8,et)])])])])])],8,me)],64)}const st=k(K,[["render",tt],["__scopeId","data-v-1dfd1ba8"]]),ot={props:["bentoTemp","generateBento","memberData"],data(){return{apiUrl:"https://whatstoday2024-8nsu.onrender.com",mealType:"午餐",bentoDate:"",bentoRecords:[]}},methods:{async getBentoRecords(){await this.axios.get(`${this.apiUrl}/600/users/${this.memberData.id}/records/`).then(t=>{console.log(t),this.bentoRecords=t.data.message})},async saveToDiary(){await this.getBentoRecords();let t=new Date().toISOString().slice(0,10);console.log(t);const s={...this.bentoTemp,date:this.bentoDate?this.bentoDate:t,mealType:this.mealType},i=this.bentoRecords.find(d=>d.date===s.date&&d.mealType===s.mealType);console.log(777,i),i?confirm("該時段已有便當紀錄，請問是否決定覆蓋該紀錄？")&&await this.axios.patch(`${this.apiUrl}/600/records/${i.id}`,s).then(o=>{console.log("done-patch",o.data.message)}):await this.axios.post(`${this.apiUrl}/600/users/${this.memberData.id}/records/`,s).then(d=>{console.log("done-post",d.data.message)})}}},p=t=>(B("data-v-98c83bf3"),t=t(),S(),t),it={class:"modal fade",id:"bentoModal",tabindex:"-1","aria-labelledby":"bentoModalLabel","aria-hidden":"true"},lt={class:"modal-dialog modal-lg modal-dialog-centered"},at={class:"modal-content bento"},dt=p(()=>e("div",{class:"modal-header px-4"},[e("h3",{class:"modal-title",id:"bentoModalLabel"},"今天吃什麼？"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),nt={class:"modal-body row m-0 row-cols-1 row-cols-lg-2"},ct={class:"bento-description col-lg-4 order-last order-lg-1 row m-0 p-lg-3"},rt={class:"nutrition-portion p-3 col-6 col-lg-12"},ht=p(()=>e("h4",{class:"mb-3 lh-base"},"營養比例：",-1)),mt={class:"row row-cols-1"},bt={class:"col row row-cols-2"},pt=p(()=>e("div",{class:"col"},[e("p",{class:"m-0"},"澱粉")],-1)),_t={class:"col"},ut={class:"m-0 text-end"},vt={class:"col row row-cols-2"},ft=p(()=>e("div",{class:"col"},[e("p",{class:"m-0"},"蛋白質")],-1)),gt={class:"col"},yt={class:"m-0 text-end"},Lt={class:"col row row-cols-2"},wt=p(()=>e("div",{class:"col"},[e("p",{class:"m-0"},"蔬菜")],-1)),Dt={class:"col"},xt={class:"m-0 text-end"},Tt=p(()=>e("div",{class:"btns text-center p-3 col-6 col-lg-12"},[e("button",{class:"btn btn-outline-primary re-generate-btn px-4 py-3 m-2","data-bs-toggle":"modal","data-bs-target":"#confirmRegenerateBentoModal"},"重新生成便當"),e("button",{class:"btn btn-primary save-to-diary-btn px-4 py-3 m-2","data-bs-toggle":"modal","data-bs-target":"#saveToBentoDiaryModal"},"存至便當日記")],-1)),Ct={class:"bento-presentation col-lg-8 order-first order-lg-2"},kt={class:"border border-gray border-3 rounded w-100 h-100 p-3 pb-4"},Bt={class:"row g-2 h-100"},St={class:"col col-4 h-50"},$t={class:"side-dish border border-gray border-3 rounded h-100"},It=["src","alt","title"],Mt={class:"col col-4 h-50"},Ut={class:"side-dish border border-gray border-3 rounded h-100"},Pt=["src","alt","title"],jt={class:"col col-4 h-50"},Vt={class:"side-dish border border-gray border-3 rounded h-100"},Rt=["src","alt","title"],Nt={class:"col col-12 h-50"},Ft={class:"border border-gray border-3 rounded col-12 h-100 p-0 d-flex"},At={class:"staple w-50"},Ot=["src","alt","title"],zt={class:"entree w-50"},Gt=["src","alt","title"],Wt={class:"modal fade",id:"confirmRegenerateBentoModal",tabindex:"-1","aria-labelledby":"confirmRegenerateBentoModalLabel","aria-hidden":"true"},qt={class:"modal-dialog modal-dialog-centered"},Et={class:"modal-content"},Ht=p(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"confirmRegenerateBentoModalLabel"},"是否確認重新生成新的便當？"),e("button",{type:"button",class:"btn-close","aria-label":"Close","data-bs-toggle":"modal","data-bs-target":"#bentoModal"})],-1)),Jt=p(()=>e("div",{class:"modal-body"}," 此操作將無法復原，請確認是否執行。 ",-1)),Kt={class:"modal-footer"},Qt=p(()=>e("button",{type:"button",class:"btn btn-secondary","data-bs-toggle":"modal","data-bs-target":"#bentoModal"},"取消",-1)),Xt={class:"modal fade",id:"saveToBentoDiaryModal",tabindex:"-1","aria-labelledby":"saveToBentoDiaryModalLabel","aria-hidden":"true"},Yt={class:"modal-dialog modal-dialog-centered"},Zt={class:"modal-content"},es=p(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"saveToBentoDiaryModalLabel"},"存至便當日記"),e("button",{type:"button",class:"btn-close","data-bs-toggle":"modal","data-bs-target":"#bentoModal","aria-label":"Close"})],-1)),ts={class:"modal-body"},ss={class:"mb-3"},os=p(()=>e("label",{class:"mx-2",for:"bentoDate"},"便當日記：",-1)),is=T('<label class="mx-2" for="bentoDate" data-v-98c83bf3>當天天氣：</label><select class="form-select w-auto d-inline-block" aria-label="what&#39;s the weather that date?" data-v-98c83bf3><option value="sunny" selected data-v-98c83bf3>晴</option><option value="cloudy" data-v-98c83bf3>陰</option><option value="rainy" data-v-98c83bf3>雨</option></select>',2),ls=p(()=>e("label",{class:"mx-2",for:"bentoDate"},"這是我的：",-1)),as={class:"btn-group",role:"group","aria-label":"Basic outlined example"},ds={class:"modal-footer"};function ns(t,s,i,d,o,l){var a,r,c,L,$,I,M,U,P,j,V,R,N,F,A;return h(),m(x,null,[e("div",it,[e("div",lt,[e("div",at,[dt,e("div",nt,[e("div",ct,[e("div",rt,[ht,e("div",mt,[e("div",bt,[pt,e("div",_t,[e("p",ut,b(Math.round(i.bentoTemp.starchTotalPortion/4*100)/100)+" 碗",1)])]),e("div",vt,[ft,e("div",gt,[e("p",yt,b(i.bentoTemp.proteinTotalPortion)+" 份",1)])]),e("div",Lt,[wt,e("div",Dt,[e("p",xt,b(i.bentoTemp.vegetableTotalPortion)+" 份",1)])])])]),Tt]),e("div",Ct,[e("div",kt,[e("div",Bt,[e("div",St,[e("div",$t,[e("img",{class:"img rounded object-fit-cover h-100",src:(a=i.bentoTemp.sideDishes[0])==null?void 0:a.imgUrl,alt:((r=i.bentoTemp.sideDishes[0])==null?void 0:r.title)+"的圖片",title:(c=i.bentoTemp.sideDishes[0])==null?void 0:c.title},null,8,It)])]),e("div",Mt,[e("div",Ut,[e("img",{class:"img rounded object-fit-cover h-100",src:(L=i.bentoTemp.sideDishes[1])==null?void 0:L.imgUrl,alt:(($=i.bentoTemp.sideDishes[1])==null?void 0:$.title)+"的圖片",title:(I=i.bentoTemp.sideDishes[1])==null?void 0:I.title},null,8,Pt)])]),e("div",jt,[e("div",Vt,[e("img",{class:"img rounded object-fit-cover h-100",src:(M=i.bentoTemp.sideDishes[2])==null?void 0:M.imgUrl,alt:((U=i.bentoTemp.sideDishes[2])==null?void 0:U.title)+"的圖片",title:(P=i.bentoTemp.sideDishes[2])==null?void 0:P.title},null,8,Rt)])]),e("div",Nt,[e("div",Ft,[e("div",At,[e("img",{class:"img img-fluid object-fit-cover h-100",src:(j=i.bentoTemp.stapleCourse)==null?void 0:j.imgUrl,alt:((V=i.bentoTemp.stapleCourse)==null?void 0:V.title)+"的圖片",title:(R=i.bentoTemp.stapleCourse)==null?void 0:R.title},null,8,Ot)]),e("div",zt,[e("img",{class:"img img-fluid object-fit-cover h-100",src:(N=i.bentoTemp.mainCourse)==null?void 0:N.imgUrl,alt:((F=i.bentoTemp.mainCourse)==null?void 0:F.title)+"的圖片",title:(A=i.bentoTemp.mainCourse)==null?void 0:A.title},null,8,Gt)])])])])])])])])])]),e("div",Wt,[e("div",qt,[e("div",Et,[Ht,Jt,e("div",Kt,[Qt,e("button",{type:"button",class:"btn btn-primary",onClick:s[0]||(s[0]=(...u)=>i.generateBento&&i.generateBento(...u)),"data-bs-toggle":"modal","data-bs-target":"#bentoModal"},"確認")])])])]),e("div",Xt,[e("div",Yt,[e("div",Zt,[es,e("div",ts,[e("div",ss,[os,y(e("input",{class:"form-control me-4 w-auto d-inline-block",id:"bentoDate",type:"date","onUpdate:modelValue":s[1]||(s[1]=u=>o.bentoDate=u)},null,512),[[G,o.bentoDate]]),is]),e("div",null,[ls,e("div",as,[e("button",{type:"button",class:v(["lunch-btn btn btn-outline-primary px-2 py-1",{active:o.mealType==="午餐"}]),onClick:s[2]||(s[2]=u=>o.mealType="午餐")},"午餐",2),e("button",{type:"button",class:v(["dinner-btn btn btn-outline-primary px-2 py-1",{active:o.mealType==="晚餐"}]),onClick:s[3]||(s[3]=u=>o.mealType="晚餐")},"晚餐",2)])])]),e("div",ds,[e("button",{type:"button",class:"btn btn-secondary","data-bs-toggle":"modal","data-bs-target":"#bentoModal",onClick:s[4]||(s[4]=(...u)=>l.getBentoRecords&&l.getBentoRecords(...u))},"取消"),e("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:s[5]||(s[5]=(...u)=>l.saveToDiary&&l.saveToDiary(...u))},"確認儲存")])])])])],64)}const cs=k(ot,[["render",ns],["__scopeId","data-v-98c83bf3"]]);console.clear();const f=2e3;document.title="來點菜單";const rs={components:{DishesComponent:st,BentoComponent:cs},data(){return{apiUrl:"https://whatstoday2024-8nsu.onrender.com",introIndex:1,mode:"default",filter:"全部",sortBy:"default",search:"",searchInput:"",searchedList:[],allDishesList:[],stapleList:[],mainDishesList:[],sideDishesList:[],selectedList:[],bentoTemp:{stapleCourse:{},mainCourse:{},sideDishes:[],date:"",mealType:"",starchTotalPortion:0,proteinTotalPortion:0,vegetableTotalPortion:0}}},computed:{...E(O,["memberData"])},watch:{sortBy(){this.getSortedDishes()},filter(){this.getSearchedDishes()}},methods:{drawOneDish(t){let s=this.mode==="default"?t.reduce((o,l)=>o+l.healthLevel,0):t.reduce((o,l)=>o+l.healthLevel+ +l.preferenceLevel,0),i=Math.random()*s;console.log(i,s);let d=0;for(let o=0;o<t.length;o++)if(i-=this.mode==="default"?t[o].healthLevel:t[o].healthLevel+ +t[o].preferenceLevel,i<=0){d=o;break}return this.bentoTemp.starchTotalPortion+=t[d].starchPortion,this.bentoTemp.proteinTotalPortion+=t[d].proteinPortion,this.bentoTemp.vegetableTotalPortion+=t[d].vegetablePortion,t[d]},drawThreeDishes(t){let s=[],i=[...t];for(;s.length<3;){let d=this.mode==="default"?t.reduce((a,r)=>a+r.healthLevel,0):t.reduce((a,r)=>a+r.healthLevel+ +r.preferenceLevel,0),o=Math.random()*d;console.log(o,d);let l=0;for(let a=0;a<i.length;a++)if(o-=this.mode==="default"?i[a].healthLevel:i[a].healthLevel+ +i[a].preferenceLevel,o<=0){l=a;break}this.bentoTemp.starchTotalPortion+=t[l].starchPortion,this.bentoTemp.proteinTotalPortion+=t[l].proteinPortion,this.bentoTemp.vegetableTotalPortion+=t[l].vegetablePortion,s.push(i[l]),i.splice(l,1)}return s},generateBento(){var o;let t=!0;const s=this.mode==="default"?this.stapleList:this.stapleList.filter(l=>l.isChecked===!0),i=this.mode==="default"?this.mainDishesList:this.mainDishesList.filter(l=>l.isChecked===!0),d=this.mode==="default"?this.sideDishesList:this.sideDishesList.filter(l=>l.isChecked===!0);s.length<1&&(t=!1,w.error("自選模式必須選取至少一種主食。",{autoClose:f})),d.length<3&&(t=!1,w.error("自選模式必須選取至少三種配菜。",{autoClose:f})),i.length<1&&(t=!1,w.error("自選模式必須選取至少一種主菜。",{autoClose:f})),console.log((o=this.bentoTemp.sideDishes)==null?void 0:o.length),t&&(this.bentoTemp={starchTotalPortion:0,proteinTotalPortion:0,vegetableTotalPortion:0},this.bentoTemp.stapleCourse=this.drawOneDish(s),this.bentoTemp.mainCourse=this.drawOneDish(i),this.bentoTemp.sideDishes=this.drawThreeDishes(d))},moveToGeneratorBentoBtn(){document.querySelector("#bentoGenerator").scrollIntoView({behavior:"smooth"})},getMode(){Object.keys(this.memberData).length!==0?this.mode=this.memberData.mode!==void 0?this.memberData.mode:"default":this.mode="default"},async setMode(t){this.mode=t,await this.axios.patch(`${this.apiUrl}/600/users/${this.memberData.id}`,{mode:t}).then(s=>{console.log(s.data.message.mode)})},async getAllDishesList(){await this.axios.get(`${this.apiUrl}/dishes`).then(t=>{this.allDishesList=t.data.message,this.allDishesList=this.allDishesList.map(s=>{const i=this.selectedList.find(d=>d.dishId===s.id);return i?{...s,isChecked:i.isChecked,preferenceLevel:+i.preferenceLevel}:{...s,isChecked:!1,preferenceLevel:1}}),this.stapleList=this.allDishesList.filter(s=>s.category==="主食類"),this.mainDishesList=this.allDishesList.filter(s=>s.category==="主菜類"),this.sideDishesList=this.allDishesList.filter(s=>s.category==="配菜類")})},async getSearchedDishes(){this.searchedList=[],this.search=this.searchInput;let t=this.apiUrl+"/dishes?title_like="+this.search+(this.filter==="全部"?"":"&category="+this.filter)+(this.sortBy!=="healthLevel"?"":"&_sort="+this.sortBy+"&_order=desc");await this.axios.get(t).then(i=>{this.searchedList=[...this.searchedList,...i.data.message]});let s=this.apiUrl+"/dishes?engTitle_like="+this.search+(this.filter==="全部"?"":"&category="+this.filter)+(this.sortBy!=="healthLevel"?"":"&_sort="+this.sortBy+"&_order=desc");await this.axios.get(s).then(i=>{this.searchedList=[...this.searchedList,...i.data.message]}),this.searchedList=this.searchedList.map(i=>{const d=this.selectedList.find(o=>o.dishId===i.id);return d?{...i,isChecked:d.isChecked,preferenceLevel:+d.preferenceLevel}:{...i,isChecked:!1,preferenceLevel:1}}),this.getSortedDishes()},async getSortedDishes(){this.sortBy==="default"?(await this.getAllDishesList(),this.search&&(this.searchedList=this.searchedList.sort((t,s)=>t.id-s.id))):this.sortBy==="preferenceLevel"?(await this.getAllDishesList(),this.allDishesList=[...this.allDishesList.filter(t=>t.isChecked===!0).sort((t,s)=>s.preferenceLevel-t.preferenceLevel),...this.allDishesList.filter(t=>t.isChecked===!1).sort((t,s)=>s.preferenceLevel-t.preferenceLevel)],this.stapleList=this.allDishesList.filter(t=>t.category==="主食類"),this.mainDishesList=this.allDishesList.filter(t=>t.category==="主菜類"),this.sideDishesList=this.allDishesList.filter(t=>t.category==="配菜類"),this.searchedList=[...this.searchedList.filter(t=>t.isChecked===!0).sort((t,s)=>s.preferenceLevel-t.preferenceLevel),...this.searchedList.filter(t=>t.isChecked===!1).sort((t,s)=>s.preferenceLevel-t.preferenceLevel)],this.selectedList=[...this.selectedList.filter(t=>t.isChecked===!0).sort((t,s)=>s.preferenceLevel-t.preferenceLevel),...this.selectedList.filter(t=>t.isChecked===!1).sort((t,s)=>s.preferenceLevel-t.preferenceLevel)]):this.sortBy==="healthLevel"&&await this.axios.get(`${this.apiUrl}/dishes?_sort=${this.sortBy}&_order=desc`).then(t=>{this.allDishesList=t.data.message,this.allDishesList=this.allDishesList.map(s=>{const i=this.selectedList.find(d=>d.dishId===s.id);return i?{...s,isChecked:i.isChecked,preferenceLevel:+i.preferenceLevel}:{...s,isChecked:!1,preferenceLevel:1}}),this.stapleList=this.allDishesList.filter(s=>s.category==="主食類"),this.mainDishesList=this.allDishesList.filter(s=>s.category==="主菜類"),this.sideDishesList=this.allDishesList.filter(s=>s.category==="配菜類")})},async getSelected(){await this.axios.get(`${this.apiUrl}/600/users/${this.memberData.id}/selecteds?_expand=dish`).then(t=>{this.selectedList=t.data.message,console.log(this.selectedList)})},async addToSelected(t){const s=this.selectedList.find(i=>i.dishId===t.id);if(s)await this.axios.patch(`${this.apiUrl}/600/selecteds/${s.id}`,{isChecked:!0}).then(()=>{this.getSelected()});else{const i={dishId:t.id,isChecked:t.isChecked,preferenceLevel:+t.preferenceLevel};await this.axios.post(`${this.apiUrl}/600/users/${this.memberData.id}/selecteds/`,i).then(()=>{this.getSelected()})}console.log("done")},async updatePreferenceLevel(t){const s=this.selectedList.find(i=>i.dishId===t.id);await this.axios.patch(`${this.apiUrl}/600/selecteds/${s.id}`,{preferenceLevel:+t.preferenceLevel}).then(()=>{this.getSelected()}).catch(()=>{w.error("發生了某些錯誤，將重新整理頁面。",{autoClose:f}),setTimeout(()=>{location.reload()},f)})},async uncheckFromSelected(t){const s=this.selectedList.find(i=>i.dishId===t.id);s?+t.preferenceLevel==1?await this.axios.delete(`${this.apiUrl}/600/selecteds/${s.id}`).then(()=>{this.getSelected()}):await this.axios.patch(`${this.apiUrl}/600/selecteds/${s.id}`,{isChecked:!1}).then(()=>{this.getSelected()}):(w.error("發生了某些錯誤，將重新整理頁面。",{autoClose:f}),setTimeout(()=>{location.reload()},f))},updateSelected(t){t.isChecked===!0?this.addToSelected(t):this.uncheckFromSelected(t)},async init(){await this.getUser(),Object.keys(this.memberData).length!==0&&(this.getMode(),await this.getSelected()),await this.getAllDishesList()},...H(O,["getUser"])},mounted(){this.init()}},n=t=>(B("data-v-82d387ab"),t=t(),S(),t),hs={class:"container"},ms=n(()=>e("div",{class:"title"},[e("h2",{class:"text-center my-3"},"帶您探索菜色的無限可能"),e("div",{class:"site-induction-btn btn p-0 d-flex"},[e("i",{class:"fa-solid fa-circle-info text-secondary fs-2",title:"網站介紹","data-bs-toggle":"modal","data-bs-target":"#siteIntroModal"})])],-1)),bs={class:"mode-btns text-center mb-3"},ps={class:"btn-group",role:"group","aria-label":"Basic outlined example"},_s={class:"filter-sort-search-container mb-2 d-flex justify-content-between"},us={class:"category-filter",style:{width:"8rem"}},vs=T('<option selected disabled data-v-82d387ab>篩選</option><option value="全部" data-v-82d387ab>全部</option><option value="主食類" data-v-82d387ab>主食類</option><option value="配菜類" data-v-82d387ab>配菜類</option><option value="主菜類" data-v-82d387ab>主菜類</option>',5),fs=[vs],gs={class:"sort-search-container d-flex justify-content-between gap-2"},ys={class:"sort-dropdown dropdown"},Ls=n(()=>e("button",{class:"btn btn-outline-primary",type:"button",id:"SortByWhatFactorDropdownMenuButton","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("strong",null,"三")],-1)),ws={class:"dropdown-menu","aria-labelledby":"SortByWhatFactorDropdownMenuButton"},Ds=n(()=>e("i",{class:"fa-solid fa-magnifying-glass"},null,-1)),xs=[Ds],Ts={class:"wrap w-80 mx-auto pt-5 pb-4"},Cs={key:0,class:"staple mb-4"},ks=n(()=>e("h3",{class:"d-inline mx-2"},"主食類",-1)),Bs=n(()=>e("small",{class:"text-danger"},"*請至少選擇一樣",-1)),Ss=n(()=>e("hr",null,null,-1)),$s={key:1,class:"dishes mb-4"},Is=n(()=>e("h3",{class:"d-inline mx-2"},"配菜類",-1)),Ms=n(()=>e("small",{class:"text-danger"},"*請至少選擇三樣",-1)),Us=n(()=>e("hr",null,null,-1)),Ps={key:2,class:"entree mb-4"},js=n(()=>e("h3",{class:"d-inline mx-2"},"主菜類",-1)),Vs=n(()=>e("small",{class:"text-danger"},"*請至少選擇一樣",-1)),Rs=n(()=>e("hr",null,null,-1)),Ns={key:3,class:"entree mb-4"},Fs=n(()=>e("h3",{class:"mx-2"},"搜尋結果",-1)),As=n(()=>e("hr",null,null,-1)),Os={id:"bentoGenerator",class:"bento-generator text-center"},zs={class:"aside"},Gs={class:"aside-head"},Ws=n(()=>e("i",{class:"fa-solid fa-angles-down"},null,-1)),qs=[Ws],Es={class:"modal fade",id:"siteIntroModal",tabindex:"-1","aria-labelledby":"siteIntroModalLabel","aria-hidden":"true"},Hs={class:"modal-dialog modal-lg modal-dialog-centered"},Js={class:"modal-content vh-75"},Ks={class:"modal-header justify-content-between"},Qs=n(()=>e("h4",{class:"modal-title",id:"siteIntroModalLabel"},"網站介紹",-1)),Xs=n(()=>e("button",{type:"button",class:"btn text-primary p-0","data-bs-dismiss":"modal","aria-label":"Close"},"略過",-1)),Ys={class:"modal-body d-flex justify-content-between align-items-center p-3"},Zs={key:0,type:"button",class:"btn prev-btn"},eo=n(()=>e("i",{class:"bi bi-chevron-left"},null,-1)),to=[eo],so=n(()=>e("div",{class:"row row-cols-1 row-cols-lg-2 align-items-center h-100 w-100"},[e("div",{class:"col col-lg-5 col-8 p-3 mx-auto align-self-center"},[e("div",null,[e("p",{class:"text-center"},"我是gif")])]),e("div",{class:"col gap-3 p-3 mx-auto mt-0"},[e("p",null,"★ 你可以 篩選出 主食、配菜與主菜"),e("p",null,"★ 你可以 依 喜好程度 或 健康推薦指數，將菜色卡片進行排序"),e("p",null,"★ 你可以 以 關鍵字 搜尋特定菜色卡片")])],-1)),oo={key:1,type:"button",class:"btn next-btn"},io=n(()=>e("i",{class:"bi bi-chevron-right"},null,-1)),lo=[io],ao=n(()=>e("div",{class:"modal-footer"},[e("div",{class:"no-show-again d-flex gap-2 mx-auto"},[e("input",{type:"checkbox",id:"no-show-again",name:"no-show-again",class:"form-check-input no-show-again-checkout"}),e("label",{for:"no-show-again"},"不再顯示")])],-1));function no(t,s,i,d,o,l){const a=z("DishesComponent"),r=z("BentoComponent");return h(),m(x,null,[e("div",hs,[ms,e("div",bs,[e("div",ps,[e("button",{type:"button",class:v(["default-mode btn btn-outline-primary px-4 py-2",{active:o.mode==="default"}]),onClick:s[0]||(s[0]=c=>l.setMode("default"))},"預設模式",2),e("button",{type:"button",class:v(["customization-mode btn btn-outline-primary px-4 py-2",{active:o.mode==="customization"}]),onClick:s[1]||(s[1]=c=>l.setMode("customization"))},"自選模式",2)])]),e("div",_s,[e("div",us,[y(e("select",{class:"form-select outline-primary","aria-label":"Default select example","onUpdate:modelValue":s[2]||(s[2]=c=>o.filter=c)},fs,512),[[C,o.filter]])]),e("div",gs,[e("div",ys,[Ls,e("ul",ws,[e("li",null,[e("a",{class:v(["dropdown-item",{active:o.sortBy==="default"}]),href:"javascript:;",onClick:s[3]||(s[3]=c=>o.sortBy="default")},"依 預設 排序",2)]),e("li",null,[e("a",{class:v(["dropdown-item",{active:o.sortBy==="preferenceLevel"}]),href:" javascript:;",onClick:s[4]||(s[4]=c=>o.sortBy="preferenceLevel")},"依 喜好程度 排序",2)]),e("li",null,[e("a",{class:v(["dropdown-item",{active:o.sortBy==="healthLevel"}]),href:"javascript:;",onClick:s[5]||(s[5]=c=>o.sortBy="healthLevel")},"依 健康分數 排序",2)])])]),e("form",{class:"search-input input-group",onSubmit:s[8]||(s[8]=J((...c)=>l.getSearchedDishes&&l.getSearchedDishes(...c),["prevent"]))},[y(e("input",{type:"text",class:"form-control",placeholder:"搜尋菜色","aria-label":"Search","aria-describedby":"Input Box For Searching Dishes",size:"10","onUpdate:modelValue":s[6]||(s[6]=c=>o.searchInput=c)},null,512),[[G,o.searchInput,void 0,{trim:!0}]]),e("button",{class:"btn btn-outline-primary",type:"button",id:"button-addon2",onClick:s[7]||(s[7]=(...c)=>l.getSearchedDishes&&l.getSearchedDishes(...c))},xs)],32)])]),e("div",{class:v(["menu border border-primary rounded mb-3 position-relative",{mask:o.mode==="default"}])},[e("div",Ts,[(o.filter==="全部"||o.filter==="主食類")&&o.search===""?(h(),m("div",Cs,[ks,Bs,Ss,D(a,{"dishes-list":o.stapleList,mode:o.mode,"modal-name":"stapleModal","update-selected":l.updateSelected,"update-preference-level":l.updatePreferenceLevel},null,8,["dishes-list","mode","update-selected","update-preference-level"])])):g("",!0),(o.filter==="全部"||o.filter==="配菜類")&&o.search===""?(h(),m("div",$s,[Is,Ms,Us,D(a,{"dishes-list":o.sideDishesList,mode:o.mode,"modal-name":"sideDishesModal","update-selected":l.updateSelected,"update-preference-level":l.updatePreferenceLevel},null,8,["dishes-list","mode","update-selected","update-preference-level"])])):g("",!0),(o.filter==="全部"||o.filter==="主菜類")&&o.search===""?(h(),m("div",Ps,[js,Vs,Rs,D(a,{"dishes-list":o.mainDishesList,mode:o.mode,"modal-name":"mainDishesModal","update-selected":l.updateSelected,"update-preference-level":l.updatePreferenceLevel},null,8,["dishes-list","mode","update-selected","update-preference-level"])])):g("",!0),o.search!==""?(h(),m("div",Ns,[Fs,As,D(a,{"dishes-list":o.searchedList,mode:o.mode,"modal-name":"searchedDishesModal","update-selected":l.updateSelected,"update-preference-level":l.updatePreferenceLevel},null,8,["dishes-list","mode","update-selected","update-preference-level"])])):g("",!0)])],2),e("div",Os,[e("button",{type:"button",class:"btn btn-outline-primary bento-generator-btn mb-4 px-4 py-3","data-bs-toggle":"modal","data-bs-target":"#bentoModal",onClick:s[9]||(s[9]=c=>{var L;return((L=o.bentoTemp.sideDishes)==null?void 0:L.length)===0?l.generateBento():null})},"生成便當")]),e("aside",zs,[e("div",Gs,[e("a",{href:"javascript:;",class:"aside-link aside-link-generator",onClick:s[10]||(s[10]=(...c)=>l.moveToGeneratorBentoBtn&&l.moveToGeneratorBentoBtn(...c))},qs)])])]),e("div",Es,[e("div",Hs,[e("div",Js,[e("div",Ks,[Qs,e("small",null,b(o.introIndex)+" / 7 ",1),Xs]),e("div",Ys,[o.introIndex!==1?(h(),m("button",Zs,to)):g("",!0),so,o.introIndex!==7?(h(),m("button",oo,lo)):g("",!0)]),ao])])]),D(r,{"bento-temp":o.bentoTemp,"generate-bento":l.generateBento,"member-data":t.memberData},null,8,["bento-temp","generate-bento","member-data"])],64)}const ro=k(rs,[["render",no],["__scopeId","data-v-82d387ab"]]);export{ro as default};
