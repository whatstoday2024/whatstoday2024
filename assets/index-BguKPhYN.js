import{_ as I,o as h,c as m,F as T,g as G,a as e,t as p,h as v,l as L,q as W,v as S,p as B,e as $,d as C,s as z,u as q,j as w,m as E,b as y,x as H,i as f,k as J,r as k}from"./index-ClkCZyIJ.js";const K={props:["dishesList","mode","modalName","updateSelected","updatePreferenceLevel"],data(){return{dishInfo:{}}},methods:{},mounted(){}},_=t=>(B("data-v-06fda671"),t=t(),$(),t),Q={key:0,class:"cards row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-4"},X={class:"card h-100"},Y=["src","alt"],Z={class:"card-body dish-info mx-auto px-0 py-3 w-80 d-flex flex-column justify-content-between"},ee=["onClick"],te=["data-bs-target"],se={class:"card-title text-center"},oe={class:"card-eng-title mb-3 d-block text-center"},ie={class:"input-group mx-auto"},le=["onUpdate:modelValue","onChange","disabled"],ae=["onUpdate:modelValue","onChange","disabled"],de=C('<option value="1" selected data-v-06fda671>1</option><option value="2" data-v-06fda671>2</option><option value="3" data-v-06fda671>3</option><option value="4" data-v-06fda671>4</option><option value="5" data-v-06fda671>5</option>',5),ne=[de],ce={key:1,class:"mx-2"},re=_(()=>e("h5",null,"沒有找到對應的菜色",-1)),he=[re],me=["id"],pe={class:"modal-dialog modal-lg modal-dialog-centered"},be={class:"modal-content dish"},_e=_(()=>e("div",{class:"modal-header px-4"},[e("h3",{class:"modal-title",id:"dishModalLabel"},"菜色介紹"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),ue={class:"modal-body"},fe={class:"row row-cols-1 row-cols-lg-2"},ve={class:"col order-last order-lg-1 row row-cols-1 gap-3 mt-0 py-3 px-0 mx-auto justify-content-center"},ge={class:"col row align-items-start"},ye=_(()=>e("div",{class:"col"},[e("h6",{class:"m-0 lh-base"},"中文菜名：")],-1)),Le={class:"col"},De={class:"m-0"},we={class:"col row align-items-start"},xe=_(()=>e("div",{class:"col"},[e("h6",{class:"m-0 lh-base"},"英文菜名：")],-1)),Te={class:"col"},Ce={class:"m-0"},ke={class:"col row align-items-center"},Se=_(()=>e("div",{class:"col"},[e("h6",{class:"m-0 lh-base"},"喜好程度：")],-1)),Ie={class:"col"},Be=["disabled"],$e=C('<option value="1" data-v-06fda671>1</option><option value="2" data-v-06fda671>2</option><option value="3" data-v-06fda671>3</option><option value="4" data-v-06fda671>4</option><option value="5" data-v-06fda671>5</option>',5),Me=[$e],Ue={class:"col row align-items-start"},Pe=_(()=>e("div",{class:"col"},[e("h6",{class:"m-0 lh-base"},"健康推薦指數：")],-1)),je={class:"col"},Ne={class:"m-0"},Ve={class:"col row align-items-start"},Re=_(()=>e("div",{class:"col"},[e("h6",{class:"m-0 lh-base"},"營養比例：")],-1)),Oe={class:"col"},Fe={class:"row row-cols-1 justify-content-between"},Ae={class:"col d-flex"},Je=_(()=>e("div",{class:"w-50"},[e("p",{class:"m-0"},"澱粉")],-1)),ze={class:"w-50"},Ge={class:"m-0 text-end"},We={class:"col d-flex"},qe=_(()=>e("div",{class:"w-50"},[e("p",{class:"m-0"},"蛋白質")],-1)),Ee={class:"w-50"},He={class:"m-0 text-end"},Ke={class:"col d-flex"},Qe=_(()=>e("div",{class:"w-50"},[e("p",{class:"m-0"},"蔬菜")],-1)),Xe={class:"w-50"},Ye={class:"m-0 text-end"},Ze={class:"col col-lg-5 col-8 p-3 order-first order-lg-2 mx-auto align-self-center"},et=["src"];function tt(t,s,i,l,o,a){return h(),m(T,null,[i.dishesList.length!==0?(h(),m("div",Q,[(h(!0),m(T,null,G(i.dishesList,d=>(h(),m("div",{class:"col",key:d.title},[e("div",X,[e("img",{src:d.imgUrl,height:"120rem",class:"card-img-top object-fit-cover",alt:d.title+"的圖片"},null,8,Y),e("div",Z,[e("div",{class:"dish-info-btn btn p-0 d-flex",onClick:c=>o.dishInfo=d},[e("i",{class:"fa-solid fa-circle-info text-secondary fs-5 lh-sm",title:"菜色介紹","data-bs-toggle":"modal","data-bs-target":"#"+i.modalName},null,8,te)],8,ee),e("h5",se,p(d.title),1),e("small",oe,p(d.engTitle),1),e("div",ie,[e("div",{class:v(["input-group-text",{"bg-grey9F":i.mode==="default"}])},[L(e("input",{class:"form-check-input mt-0",type:"checkbox","aria-label":"Checkbox for following text input","onUpdate:modelValue":c=>d.isChecked=c,onChange:c=>i.updateSelected(d),disabled:i.mode==="default"},null,40,le),[[W,d.isChecked]])],2),L(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":c=>d.preferenceLevel=c,onChange:c=>i.updatePreferenceLevel(d),disabled:!d.isChecked||i.mode==="default"},ne,40,ae),[[S,d.preferenceLevel]])])])])]))),128))])):(h(),m("div",ce,he)),e("div",{class:"modal fade",id:i.modalName,tabindex:"-1","aria-labelledby":"dishModalLabel","aria-hidden":"true"},[e("div",pe,[e("div",be,[_e,e("div",ue,[e("div",fe,[e("div",ve,[e("div",ge,[ye,e("div",Le,[e("p",De,p(o.dishInfo.title),1)])]),e("div",we,[xe,e("div",Te,[e("p",Ce,p(o.dishInfo.engTitle),1)])]),e("div",ke,[Se,e("div",Ie,[L(e("select",{class:"form-select w-75","aria-label":"Default select example",disabled:!o.dishInfo.isChecked,"onUpdate:modelValue":s[0]||(s[0]=d=>o.dishInfo.preferenceLevel=d)},Me,8,Be),[[S,o.dishInfo.preferenceLevel]])])]),e("div",Ue,[Pe,e("div",je,[e("p",Ne,p(o.dishInfo.healthLevel),1)])]),e("div",Ve,[Re,e("div",Oe,[e("div",Fe,[e("div",Ae,[Je,e("div",ze,[e("p",Ge,p(o.dishInfo.starchPortion/4)+" 碗",1)])]),e("div",We,[qe,e("div",Ee,[e("p",He,p(o.dishInfo.proteinPortion)+" 份",1)])]),e("div",Ke,[Qe,e("div",Xe,[e("p",Ye,p(o.dishInfo.vegetablePortion)+" 份",1)])])])])])]),e("div",Ze,[e("img",{class:"object-fit-cover",src:o.dishInfo.imgUrl,alt:""},null,8,et)])])])])])],8,me)],64)}const st=I(K,[["render",tt],["__scopeId","data-v-06fda671"]]),ot={props:["bentoTemp","generateBento","memberData"],data(){return{apiUrl:"https://whatstoday2024-8nsu.onrender.com",mealType:"午餐",bentoDate:"",bentoRecords:[]}},methods:{async getBentoRecords(){await this.axios.get(`${this.apiUrl}/600/users/${this.memberData.id}/records/`).then(t=>{console.log(t),this.bentoRecords=t.data.message})},async saveToDiary(){await this.getBentoRecords();let t=new Date().toISOString().slice(0,10);console.log(t);const s={...this.bentoTemp,date:this.bentoDate?this.bentoDate:t,mealType:this.mealType},i=this.bentoRecords.find(l=>l.date===s.date&&l.mealType===s.mealType);console.log(777,i),i?confirm("該時段已有便當紀錄，請問是否決定覆蓋該紀錄？")&&await this.axios.patch(`${this.apiUrl}/600/records/${i.id}`,s).then(o=>{console.log("done-patch",o.data.message)}):await this.axios.post(`${this.apiUrl}/600/users/${this.memberData.id}/records/`,s).then(l=>{console.log("done-post",l.data.message)})}}},b=t=>(B("data-v-78aff3ed"),t=t(),$(),t),it={class:"modal fade",id:"bentoModal",tabindex:"-1","aria-labelledby":"bentoModalLabel","aria-hidden":"true"},lt={class:"modal-dialog modal-lg modal-dialog-centered"},at={class:"modal-content bento"},dt=b(()=>e("div",{class:"modal-header px-4"},[e("h3",{class:"modal-title",id:"bentoModalLabel"},"今天吃什麼？"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),nt={class:"modal-body row m-0 row-cols-1 row-cols-lg-2"},ct={class:"bento-description col-lg-4 order-last order-lg-1 row m-0 p-lg-3"},rt={class:"nutrition-portion p-3 col-6 col-lg-12"},ht=b(()=>e("h4",{class:"mb-3 lh-base"},"營養比例：",-1)),mt={class:"row row-cols-1"},pt={class:"col row row-cols-2"},bt=b(()=>e("div",{class:"col"},[e("p",{class:"m-0"},"澱粉")],-1)),_t={class:"col"},ut={class:"m-0 text-end"},ft={class:"col row row-cols-2"},vt=b(()=>e("div",{class:"col"},[e("p",{class:"m-0"},"蛋白質")],-1)),gt={class:"col"},yt={class:"m-0 text-end"},Lt={class:"col row row-cols-2"},Dt=b(()=>e("div",{class:"col"},[e("p",{class:"m-0"},"蔬菜")],-1)),wt={class:"col"},xt={class:"m-0 text-end"},Tt=b(()=>e("div",{class:"btns text-center p-3 col-6 col-lg-12"},[e("button",{class:"btn btn-outline-primary re-generate-btn px-4 py-3 m-2","data-bs-toggle":"modal","data-bs-target":"#confirmRegenerateBentoModal"},"重新生成便當"),e("button",{class:"btn btn-primary save-to-diary-btn px-4 py-3 m-2","data-bs-toggle":"modal","data-bs-target":"#saveToBentoDiaryModal"},"存至便當日記")],-1)),Ct={class:"bento-presentation col-lg-8 order-first order-lg-2"},kt={class:"border border-gray border-3 rounded w-100 h-100 p-3 pb-4"},St={class:"row g-2 h-100"},It={class:"col col-4 h-50"},Bt={class:"side-dish border border-gray border-3 rounded h-100"},$t=["src","alt","title"],Mt={class:"col col-4 h-50"},Ut={class:"side-dish border border-gray border-3 rounded h-100"},Pt=["src","alt","title"],jt={class:"col col-4 h-50"},Nt={class:"side-dish border border-gray border-3 rounded h-100"},Vt=["src","alt","title"],Rt={class:"col col-12 h-50"},Ot={class:"border border-gray border-3 rounded col-12 h-100 p-0 d-flex"},Ft={class:"staple w-50"},At=["src","alt","title"],Jt={class:"entree w-50"},zt=["src","alt","title"],Gt={class:"modal fade",id:"confirmRegenerateBentoModal",tabindex:"-1","aria-labelledby":"confirmRegenerateBentoModalLabel","aria-hidden":"true"},Wt={class:"modal-dialog modal-dialog-centered"},qt={class:"modal-content"},Et=b(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"confirmRegenerateBentoModalLabel"},"是否確認重新生成新的便當？"),e("button",{type:"button",class:"btn-close","aria-label":"Close","data-bs-toggle":"modal","data-bs-target":"#bentoModal"})],-1)),Ht=b(()=>e("div",{class:"modal-body"}," 此操作將無法復原，請確認是否執行。 ",-1)),Kt={class:"modal-footer"},Qt=b(()=>e("button",{type:"button",class:"btn btn-secondary","data-bs-toggle":"modal","data-bs-target":"#bentoModal"},"取消",-1)),Xt={class:"modal fade",id:"saveToBentoDiaryModal",tabindex:"-1","aria-labelledby":"saveToBentoDiaryModalLabel","aria-hidden":"true"},Yt={class:"modal-dialog modal-dialog-centered"},Zt={class:"modal-content"},es=b(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"saveToBentoDiaryModalLabel"},"存至便當日記"),e("button",{type:"button",class:"btn-close","data-bs-toggle":"modal","data-bs-target":"#bentoModal","aria-label":"Close"})],-1)),ts={class:"modal-body"},ss={class:"mb-3"},os=b(()=>e("label",{class:"mx-2",for:"bentoDate"},"便當日記：",-1)),is=C('<label class="mx-2" for="bentoDate" data-v-78aff3ed>當天天氣：</label><select class="form-select w-auto d-inline-block" aria-label="what&#39;s the weather that date?" data-v-78aff3ed><option value="sunny" selected data-v-78aff3ed>晴</option><option value="cloudy" data-v-78aff3ed>陰</option><option value="rainy" data-v-78aff3ed>雨</option></select>',2),ls=b(()=>e("label",{class:"mx-2",for:"bentoDate"},"這是我的：",-1)),as={class:"btn-group",role:"group","aria-label":"Basic outlined example"},ds={class:"modal-footer"};function ns(t,s,i,l,o,a){var d,c,x,n,D,M,U,P,j,N,V,R,O,F,A;return h(),m(T,null,[e("div",it,[e("div",lt,[e("div",at,[dt,e("div",nt,[e("div",ct,[e("div",rt,[ht,e("div",mt,[e("div",pt,[bt,e("div",_t,[e("p",ut,p(Math.round(i.bentoTemp.starchTotalPortion/4*100)/100)+" 碗",1)])]),e("div",ft,[vt,e("div",gt,[e("p",yt,p(i.bentoTemp.proteinTotalPortion)+" 份",1)])]),e("div",Lt,[Dt,e("div",wt,[e("p",xt,p(i.bentoTemp.vegetableTotalPortion)+" 份",1)])])])]),Tt]),e("div",Ct,[e("div",kt,[e("div",St,[e("div",It,[e("div",Bt,[e("img",{class:"img rounded object-fit-cover h-100",src:(d=i.bentoTemp.sideDishes[0])==null?void 0:d.imgUrl,alt:((c=i.bentoTemp.sideDishes[0])==null?void 0:c.title)+"的圖片",title:(x=i.bentoTemp.sideDishes[0])==null?void 0:x.title},null,8,$t)])]),e("div",Mt,[e("div",Ut,[e("img",{class:"img rounded object-fit-cover h-100",src:(n=i.bentoTemp.sideDishes[1])==null?void 0:n.imgUrl,alt:((D=i.bentoTemp.sideDishes[1])==null?void 0:D.title)+"的圖片",title:(M=i.bentoTemp.sideDishes[1])==null?void 0:M.title},null,8,Pt)])]),e("div",jt,[e("div",Nt,[e("img",{class:"img rounded object-fit-cover h-100",src:(U=i.bentoTemp.sideDishes[2])==null?void 0:U.imgUrl,alt:((P=i.bentoTemp.sideDishes[2])==null?void 0:P.title)+"的圖片",title:(j=i.bentoTemp.sideDishes[2])==null?void 0:j.title},null,8,Vt)])]),e("div",Rt,[e("div",Ot,[e("div",Ft,[e("img",{class:"img img-fluid object-fit-cover h-100",src:(N=i.bentoTemp.stapleCourse)==null?void 0:N.imgUrl,alt:((V=i.bentoTemp.stapleCourse)==null?void 0:V.title)+"的圖片",title:(R=i.bentoTemp.stapleCourse)==null?void 0:R.title},null,8,At)]),e("div",Jt,[e("img",{class:"img img-fluid object-fit-cover h-100",src:(O=i.bentoTemp.mainCourse)==null?void 0:O.imgUrl,alt:((F=i.bentoTemp.mainCourse)==null?void 0:F.title)+"的圖片",title:(A=i.bentoTemp.mainCourse)==null?void 0:A.title},null,8,zt)])])])])])])])])])]),e("div",Gt,[e("div",Wt,[e("div",qt,[Et,Ht,e("div",Kt,[Qt,e("button",{type:"button",class:"btn btn-primary",onClick:s[0]||(s[0]=(...u)=>i.generateBento&&i.generateBento(...u)),"data-bs-toggle":"modal","data-bs-target":"#bentoModal"},"確認")])])])]),e("div",Xt,[e("div",Yt,[e("div",Zt,[es,e("div",ts,[e("div",ss,[os,L(e("input",{class:"form-control me-4 w-auto d-inline-block",id:"bentoDate",type:"date","onUpdate:modelValue":s[1]||(s[1]=u=>o.bentoDate=u)},null,512),[[z,o.bentoDate]]),is]),e("div",null,[ls,e("div",as,[e("button",{type:"button",class:v(["lunch-btn btn btn-outline-primary px-2 py-1",{active:o.mealType==="午餐"}]),onClick:s[2]||(s[2]=u=>o.mealType="午餐")},"午餐",2),e("button",{type:"button",class:v(["dinner-btn btn btn-outline-primary px-2 py-1",{active:o.mealType==="晚餐"}]),onClick:s[3]||(s[3]=u=>o.mealType="晚餐")},"晚餐",2)])])]),e("div",ds,[e("button",{type:"button",class:"btn btn-secondary","data-bs-toggle":"modal","data-bs-target":"#bentoModal",onClick:s[4]||(s[4]=(...u)=>a.getBentoRecords&&a.getBentoRecords(...u))},"取消"),e("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:s[5]||(s[5]=(...u)=>a.saveToDiary&&a.saveToDiary(...u))},"確認儲存")])])])])],64)}const cs=I(ot,[["render",ns],["__scopeId","data-v-78aff3ed"]]);console.clear();const g=2e3;document.title="來點菜單";const rs={components:{DishesComponent:st,BentoComponent:cs},data(){return{isLoading:!1,apiUrl:"https://whatstoday2024-8nsu.onrender.com",introIndex:1,mode:"default",filter:"全部",sortBy:"default",search:"",searchInput:"",searchedList:[],allDishesList:[],stapleList:[],mainDishesList:[],sideDishesList:[],selectedList:[],bentoTemp:{stapleCourse:{},mainCourse:{},sideDishes:[],date:"",mealType:"",starchTotalPortion:0,proteinTotalPortion:0,vegetableTotalPortion:0}}},computed:{...q(J,["memberData","hasCheckLogin"])},watch:{sortBy(){this.getSortedDishes()},filter(){this.getSearchedDishes()}},methods:{drawOneDish(t){let s=this.mode==="default"?t.reduce((o,a)=>o+a.healthLevel,0):t.reduce((o,a)=>o+a.healthLevel+ +a.preferenceLevel,0),i=Math.random()*s,l=0;for(let o=0;o<t.length;o++)if(i-=this.mode==="default"?t[o].healthLevel:t[o].healthLevel+ +t[o].preferenceLevel,i<=0){l=o;break}return this.bentoTemp.starchTotalPortion+=t[l].starchPortion,this.bentoTemp.proteinTotalPortion+=t[l].proteinPortion,this.bentoTemp.vegetableTotalPortion+=t[l].vegetablePortion,t[l]},drawThreeDishes(t){let s=[],i=[...t];for(;s.length<3;){let l=this.mode==="default"?i.reduce((d,c)=>d+c.healthLevel,0):i.reduce((d,c)=>d+c.healthLevel+ +c.preferenceLevel,0),o=Math.random()*l,a=0;for(let d=0;d<i.length;d++)if(o-=this.mode==="default"?i[d].healthLevel:i[d].healthLevel+ +i[d].preferenceLevel,o<=0){a=d;break}this.bentoTemp.starchTotalPortion+=t[a].starchPortion,this.bentoTemp.proteinTotalPortion+=t[a].proteinPortion,this.bentoTemp.vegetableTotalPortion+=t[a].vegetablePortion,s.push(i[a]),i.splice(a,1)}return s},generateBento(){console.clear(),this.isLoading=!0;let t=!0;const s=this.mode==="default"?this.stapleList:this.stapleList.filter(o=>o.isChecked===!0),i=this.mode==="default"?this.mainDishesList:this.mainDishesList.filter(o=>o.isChecked===!0),l=this.mode==="default"?this.sideDishesList:this.sideDishesList.filter(o=>o.isChecked===!0);if(s.length<1&&(t=!1,w.error("自選模式必須選取至少一種主食。",{autoClose:g})),l.length<3&&(t=!1,w.error("自選模式必須選取至少三種配菜。",{autoClose:g})),i.length<1&&(t=!1,w.error("自選模式必須選取至少一種主菜。",{autoClose:g})),!t){this.isLoading=!1;return}this.bentoTemp={starchTotalPortion:0,proteinTotalPortion:0,vegetableTotalPortion:0},this.bentoTemp.stapleCourse=this.drawOneDish(s),this.bentoTemp.mainCourse=this.drawOneDish(i),this.bentoTemp.sideDishes=this.drawThreeDishes(l),this.isLoading=!1},moveToGeneratorBentoBtn(){document.querySelector("#bentoGenerator").scrollIntoView({behavior:"smooth"})},getMode(){if(this.memberData.id)this.mode=this.memberData.mode!==void 0?this.memberData.mode:"default";else{let t=localStorage.getItem("mode");this.mode=t||"default"}},async setMode(t){this.mode=t,this.memberData.id?await this.axios.patch(`${this.apiUrl}/600/users/${this.memberData.id}`,{mode:t}):localStorage.setItem("mode",this.mode)},async getAllDishesList(){await this.getSelected(),await this.axios.get(`${this.apiUrl}/dishes`).then(t=>{this.allDishesList=t.data.message,this.allDishesList=this.allDishesList.map(s=>{const i=this.selectedList.find(l=>l.dishId===s.id);return i?{...s,isChecked:i.isChecked,preferenceLevel:+i.preferenceLevel}:{...s,isChecked:!1,preferenceLevel:1}}),this.stapleList=this.allDishesList.filter(s=>s.category==="主食類"),this.mainDishesList=this.allDishesList.filter(s=>s.category==="主菜類"),this.sideDishesList=this.allDishesList.filter(s=>s.category==="配菜類")})},async getSearchedDishes(){this.searchedList=[],this.search=this.searchInput;let t=this.apiUrl+"/dishes?title_like="+this.search+(this.filter==="全部"?"":"&category="+this.filter)+(this.sortBy!=="healthLevel"?"":"&_sort="+this.sortBy+"&_order=desc");await this.axios.get(t).then(i=>{this.searchedList=[...this.searchedList,...i.data.message]});let s=this.apiUrl+"/dishes?engTitle_like="+this.search+(this.filter==="全部"?"":"&category="+this.filter)+(this.sortBy!=="healthLevel"?"":"&_sort="+this.sortBy+"&_order=desc");await this.axios.get(s).then(i=>{this.searchedList=[...this.searchedList,...i.data.message]}),this.searchedList=this.searchedList.map(i=>{const l=this.selectedList.find(o=>o.dishId===i.id);return l?{...i,isChecked:l.isChecked,preferenceLevel:+l.preferenceLevel}:{...i,isChecked:!1,preferenceLevel:1}}),this.getSortedDishes()},async getSortedDishes(){this.sortBy==="default"?(await this.getAllDishesList(),this.search&&(this.searchedList=this.searchedList.sort((t,s)=>t.id-s.id))):this.sortBy==="preferenceLevel"?(await this.getAllDishesList(),this.allDishesList=[...this.allDishesList.filter(t=>t.isChecked===!0).sort((t,s)=>s.preferenceLevel-t.preferenceLevel),...this.allDishesList.filter(t=>t.isChecked===!1).sort((t,s)=>s.preferenceLevel-t.preferenceLevel)],this.stapleList=this.allDishesList.filter(t=>t.category==="主食類"),this.mainDishesList=this.allDishesList.filter(t=>t.category==="主菜類"),this.sideDishesList=this.allDishesList.filter(t=>t.category==="配菜類"),this.searchedList=[...this.searchedList.filter(t=>t.isChecked===!0).sort((t,s)=>s.preferenceLevel-t.preferenceLevel),...this.searchedList.filter(t=>t.isChecked===!1).sort((t,s)=>s.preferenceLevel-t.preferenceLevel)],this.selectedList=[...this.selectedList.filter(t=>t.isChecked===!0).sort((t,s)=>s.preferenceLevel-t.preferenceLevel),...this.selectedList.filter(t=>t.isChecked===!1).sort((t,s)=>s.preferenceLevel-t.preferenceLevel)]):this.sortBy==="healthLevel"&&await this.axios.get(`${this.apiUrl}/dishes?_sort=${this.sortBy}&_order=desc`).then(t=>{this.allDishesList=t.data.message,this.allDishesList=this.allDishesList.map(s=>{const i=this.selectedList.find(l=>l.dishId===s.id);return i?{...s,isChecked:i.isChecked,preferenceLevel:+i.preferenceLevel}:{...s,isChecked:!1,preferenceLevel:1}}),this.stapleList=this.allDishesList.filter(s=>s.category==="主食類"),this.mainDishesList=this.allDishesList.filter(s=>s.category==="主菜類"),this.sideDishesList=this.allDishesList.filter(s=>s.category==="配菜類")})},async getSelected(){if(this.memberData.id)await this.axios.get(`${this.apiUrl}/600/users/${this.memberData.id}/selecteds?_expand=dish`).then(t=>{this.selectedList=t.data.message});else{let t=JSON.parse(localStorage.getItem("selectedList"));this.selectedList=t||[]}},async addToSelected(t){this.getSelected();const s=this.selectedList.find(l=>l.dishId===t.id),i=this.selectedList.findIndex(l=>l.dishId===t.id);if(s)this.memberData.id?await this.axios.patch(`${this.apiUrl}/600/selecteds/${s.id}`,{isChecked:!0}):(this.selectedList[i].isChecked=!0,localStorage.setItem("selectedList",JSON.stringify(this.selectedList)));else{const l={dishId:t.id,isChecked:t.isChecked,preferenceLevel:+t.preferenceLevel};this.memberData.id?await this.axios.post(`${this.apiUrl}/600/users/${this.memberData.id}/selecteds/`,l):(this.selectedList.push(l),localStorage.setItem("selectedList",JSON.stringify(this.selectedList)))}this.getSelected()},async updatePreferenceLevel(t){this.getSelected();const s=this.selectedList.find(l=>l.dishId===t.id),i=this.selectedList.findIndex(l=>l.dishId===t.id);this.memberData.id?await this.axios.patch(`${this.apiUrl}/600/selecteds/${s.id}`,{preferenceLevel:+t.preferenceLevel}).catch(()=>{w.error("發生了某些錯誤，將重新整理頁面。",{autoClose:g}),setTimeout(()=>{location.reload()},g)}):(this.selectedList[i].preferenceLevel=+t.preferenceLevel,localStorage.setItem("selectedList",JSON.stringify(this.selectedList))),this.getSelected()},async uncheckFromSelected(t){this.getSelected();const s=this.selectedList.find(l=>l.dishId===t.id),i=this.selectedList.findIndex(l=>l.dishId===t.id);s?+t.preferenceLevel==1?this.memberData.id?await this.axios.delete(`${this.apiUrl}/600/selecteds/${s.id}`):(this.selectedList.splice(i,1),localStorage.setItem("selectedList",JSON.stringify(this.selectedList))):this.memberData.id?await this.axios.patch(`${this.apiUrl}/600/selecteds/${s.id}`,{isChecked:!1}):(this.selectedList[i].isChecked=!1,localStorage.setItem("selectedList",JSON.stringify(this.selectedList))):(w.error("發生了某些錯誤，將重新整理頁面。",{autoClose:g}),setTimeout(()=>{location.reload()},g)),this.getSelected()},updateSelected(t){t.isChecked===!0?this.addToSelected(t):this.uncheckFromSelected(t)},async init(){await this.getUser(),this.getMode(),await this.getAllDishesList()},...E(J,["getUser"])},mounted(){this.init()}},r=t=>(B("data-v-92062abd"),t=t(),$(),t),hs={class:"container"},ms=r(()=>e("div",{class:"title"},[e("h2",{class:"text-center my-3"},"帶您探索菜色的無限可能"),e("div",{class:"site-induction-btn btn p-0 d-flex"},[e("i",{class:"fa-solid fa-circle-info text-secondary fs-2",title:"網站介紹","data-bs-toggle":"modal","data-bs-target":"#siteIntroModal"})])],-1)),ps={class:"mode-btns text-center mb-3"},bs={class:"btn-group",role:"group","aria-label":"Basic outlined example"},_s={class:"filter-sort-search-container mb-2 d-flex justify-content-between"},us={class:"category-filter",style:{width:"8rem"}},fs=C('<option selected disabled data-v-92062abd>篩選</option><option value="全部" data-v-92062abd>全部</option><option value="主食類" data-v-92062abd>主食類</option><option value="配菜類" data-v-92062abd>配菜類</option><option value="主菜類" data-v-92062abd>主菜類</option>',5),vs=[fs],gs={class:"sort-search-container d-flex justify-content-between gap-2"},ys={class:"sort-dropdown dropdown"},Ls=r(()=>e("button",{class:"btn btn-outline-primary",type:"button",id:"SortByWhatFactorDropdownMenuButton","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("strong",null,"三")],-1)),Ds={class:"dropdown-menu","aria-labelledby":"SortByWhatFactorDropdownMenuButton"},ws=r(()=>e("i",{class:"fa-solid fa-magnifying-glass"},null,-1)),xs=[ws],Ts={class:"wrap w-80 mx-auto pt-5 pb-4"},Cs={key:0,class:"staple mb-4"},ks=r(()=>e("h3",{class:"d-inline mx-2"},"主食類",-1)),Ss={key:0,class:"text-danger"},Is=r(()=>e("hr",null,null,-1)),Bs={key:1,class:"dishes mb-4"},$s=r(()=>e("h3",{class:"d-inline mx-2"},"配菜類",-1)),Ms={key:0,class:"text-danger"},Us=r(()=>e("hr",null,null,-1)),Ps={key:2,class:"entree mb-4"},js=r(()=>e("h3",{class:"d-inline mx-2"},"主菜類",-1)),Ns={key:0,class:"text-danger"},Vs=r(()=>e("hr",null,null,-1)),Rs={key:3,class:"entree mb-4"},Os=r(()=>e("h3",{class:"mx-2"},"搜尋結果",-1)),Fs=r(()=>e("hr",null,null,-1)),As={id:"bentoGenerator",class:"bento-generator text-center"},Js={class:"aside"},zs={class:"aside-head"},Gs=r(()=>e("i",{class:"fa-solid fa-angles-down"},null,-1)),Ws=[Gs],qs={class:"modal fade",id:"siteIntroModal",tabindex:"-1","aria-labelledby":"siteIntroModalLabel","aria-hidden":"true"},Es={class:"modal-dialog modal-lg modal-dialog-centered"},Hs={class:"modal-content vh-75"},Ks={class:"modal-header justify-content-between"},Qs=r(()=>e("h4",{class:"modal-title",id:"siteIntroModalLabel"},"網站介紹",-1)),Xs=r(()=>e("button",{type:"button",class:"btn text-primary p-0","data-bs-dismiss":"modal","aria-label":"Close"},"略過",-1)),Ys={class:"modal-body d-flex justify-content-between align-items-center p-3"},Zs={key:0,type:"button",class:"btn prev-btn"},eo=r(()=>e("i",{class:"bi bi-chevron-left"},null,-1)),to=[eo],so=r(()=>e("div",{class:"row row-cols-1 row-cols-lg-2 align-items-center h-100 w-100"},[e("div",{class:"col col-lg-5 col-8 p-3 mx-auto align-self-center"},[e("div",null,[e("p",{class:"text-center"},"我是gif")])]),e("div",{class:"col gap-3 p-3 mx-auto mt-0"},[e("p",null,"★ 你可以 篩選出 主食、配菜與主菜"),e("p",null,"★ 你可以 依 喜好程度 或 健康推薦指數，將菜色卡片進行排序"),e("p",null,"★ 你可以 以 關鍵字 搜尋特定菜色卡片")])],-1)),oo={key:1,type:"button",class:"btn next-btn"},io=r(()=>e("i",{class:"bi bi-chevron-right"},null,-1)),lo=[io],ao=r(()=>e("div",{class:"modal-footer"},[e("div",{class:"no-show-again d-flex gap-2 mx-auto"},[e("input",{type:"checkbox",id:"no-show-again",name:"no-show-again",class:"form-check-input no-show-again-checkout"}),e("label",{for:"no-show-again"},"不再顯示")])],-1));function no(t,s,i,l,o,a){const d=k("loadingVue"),c=k("DishesComponent"),x=k("BentoComponent");return h(),m(T,null,[y(d,{active:o.isLoading},null,8,["active"]),e("div",hs,[ms,e("div",ps,[e("div",bs,[e("button",{type:"button",class:v(["default-mode btn btn-outline-primary px-4 py-2",{active:o.mode==="default"}]),onClick:s[0]||(s[0]=n=>a.setMode("default"))},"預設模式",2),e("button",{type:"button",class:v(["customization-mode btn btn-outline-primary px-4 py-2",{active:o.mode==="customization"}]),onClick:s[1]||(s[1]=n=>a.setMode("customization"))},"自選模式",2)])]),e("div",_s,[e("div",us,[L(e("select",{class:"form-select outline-primary","aria-label":"Default select example","onUpdate:modelValue":s[2]||(s[2]=n=>o.filter=n)},vs,512),[[S,o.filter]])]),e("div",gs,[e("div",ys,[Ls,e("ul",Ds,[e("li",null,[e("a",{class:v(["dropdown-item",{active:o.sortBy==="default"}]),href:"javascript:;",onClick:s[3]||(s[3]=n=>o.sortBy="default")},"依 預設 排序",2)]),e("li",null,[e("a",{class:v(["dropdown-item",{active:o.sortBy==="preferenceLevel"}]),href:" javascript:;",onClick:s[4]||(s[4]=n=>o.sortBy="preferenceLevel")},"依 喜好程度 排序",2)]),e("li",null,[e("a",{class:v(["dropdown-item",{active:o.sortBy==="healthLevel"}]),href:"javascript:;",onClick:s[5]||(s[5]=n=>o.sortBy="healthLevel")},"依 健康分數 排序",2)])])]),e("form",{class:"search-input input-group",onSubmit:s[8]||(s[8]=H((...n)=>a.getSearchedDishes&&a.getSearchedDishes(...n),["prevent"]))},[L(e("input",{type:"text",class:"form-control",placeholder:"搜尋菜色","aria-label":"Search","aria-describedby":"Input Box For Searching Dishes",size:"10","onUpdate:modelValue":s[6]||(s[6]=n=>o.searchInput=n)},null,512),[[z,o.searchInput,void 0,{trim:!0}]]),e("button",{class:"btn btn-outline-primary",type:"button",id:"button-addon2",onClick:s[7]||(s[7]=(...n)=>a.getSearchedDishes&&a.getSearchedDishes(...n))},xs)],32)])]),e("div",{class:v(["menu border border-primary rounded mb-3 position-relative",{mask:o.mode==="default"}])},[e("div",Ts,[(o.filter==="全部"||o.filter==="主食類")&&o.search===""?(h(),m("div",Cs,[ks,o.stapleList.filter(n=>n.isChecked===!0).length<1?(h(),m("small",Ss,"*請至少選擇一樣")):f("",!0),Is,y(c,{"dishes-list":o.stapleList,mode:o.mode,"modal-name":"stapleModal","update-selected":a.updateSelected,"update-preference-level":a.updatePreferenceLevel},null,8,["dishes-list","mode","update-selected","update-preference-level"])])):f("",!0),(o.filter==="全部"||o.filter==="配菜類")&&o.search===""?(h(),m("div",Bs,[$s,o.sideDishesList.filter(n=>n.isChecked===!0).length<3?(h(),m("small",Ms,"*請至少選擇三樣")):f("",!0),Us,y(c,{"dishes-list":o.sideDishesList,mode:o.mode,"modal-name":"sideDishesModal","update-selected":a.updateSelected,"update-preference-level":a.updatePreferenceLevel},null,8,["dishes-list","mode","update-selected","update-preference-level"])])):f("",!0),(o.filter==="全部"||o.filter==="主菜類")&&o.search===""?(h(),m("div",Ps,[js,o.mainDishesList.filter(n=>n.isChecked===!0).length<1?(h(),m("small",Ns,"*請至少選擇一樣")):f("",!0),Vs,y(c,{"dishes-list":o.mainDishesList,mode:o.mode,"modal-name":"mainDishesModal","update-selected":a.updateSelected,"update-preference-level":a.updatePreferenceLevel},null,8,["dishes-list","mode","update-selected","update-preference-level"])])):f("",!0),o.search!==""?(h(),m("div",Rs,[Os,Fs,y(c,{"dishes-list":o.searchedList,mode:o.mode,"modal-name":"searchedDishesModal","update-selected":a.updateSelected,"update-preference-level":a.updatePreferenceLevel},null,8,["dishes-list","mode","update-selected","update-preference-level"])])):f("",!0)])],2),e("div",As,[e("button",{type:"button",class:"btn btn-outline-primary bento-generator-btn mb-4 px-4 py-3","data-bs-toggle":"modal","data-bs-target":"#bentoModal",onClick:s[9]||(s[9]=n=>{var D;return((D=o.bentoTemp.sideDishes)==null?void 0:D.length)===0?a.generateBento():null})},"生成便當")]),e("aside",Js,[e("div",zs,[e("a",{href:"javascript:;",class:"aside-link aside-link-generator",onClick:s[10]||(s[10]=(...n)=>a.moveToGeneratorBentoBtn&&a.moveToGeneratorBentoBtn(...n))},Ws)])])]),e("div",qs,[e("div",Es,[e("div",Hs,[e("div",Ks,[Qs,e("small",null,p(o.introIndex)+" / 7 ",1),Xs]),e("div",Ys,[o.introIndex!==1?(h(),m("button",Zs,to)):f("",!0),so,o.introIndex!==7?(h(),m("button",oo,lo)):f("",!0)]),ao])])]),y(x,{"bento-temp":o.bentoTemp,"generate-bento":a.generateBento,"member-data":t.memberData},null,8,["bento-temp","generate-bento","member-data"])],64)}const ro=I(rs,[["render",no],["__scopeId","data-v-92062abd"]]);export{ro as default};
