import{m as w}from"./memberData-B3nG-T8E.js";import{_ as v,l as g,c as u,d as o,b as e,t as k,w as f,j as p,F as V,e as c,o as h,i as m}from"./index-4BPesMZs.js";const y={data(){return{dinnerCount:0,renameInvalid:!1,password:{old:"",new:"",doubleCheck:""},isLoading:!1}},emits:["updateProfile"],computed:{user(){if(this.memberData.email){const{email:a,nickname:s}=this.memberData;return{email:a,nickname:s}}else return{}},...g(w,["memberData"])},methods:{getProfile(){this.dinnerCount=166},editProfile(){if(this.user.nickname===this.memberData.nickname){this.renameInvalid=!0;return}this.isLoading=!0,this.axios.patch(`https://whatstoday2024.onrender.com/600/users/${this.memberData.id}`,{nickname:this.user.nickname}).then(()=>{alert("會員名稱修改成功"),this.$emit("updateProfile"),this.isLoading=!1}).catch(()=>{alert("會員名稱修改失敗"),this.$emit("updateProfile"),this.isLoading=!1})},async changePassword(){this.isLoading=!0,await this.checkPassword()?this.axios.patch(`https://whatstoday2024.onrender.com/600/users/${this.memberData.id}`,{password:this.password.new}).then(()=>{alert("密碼修改成功"),this.$emit("updateProfile")}).catch(()=>{alert("密碼修改失敗"),this.isLoading=!1}):(alert("舊密碼輸入不正確"),this.isLoading=!1)},checkPassword(){const a={email:this.user.email,password:this.password.old};return new Promise(s=>{this.axios.post("https://whatstoday2024.onrender.com/login",a).then(()=>{s(!0)}).catch(()=>{s(!1)})})}},mounted(){this.getProfile();const a=this.$cookie.getMemberToken();a&&(this.axios.defaults.headers.common.Authorization=`Bearer ${a}`)}},P={class:"flex-fill d-flex align-items-center"},x={class:"container py-5"},C=e("h1",{class:"display-5 mb-4"},"個人資料總覽",-1),D={key:0,class:"row g-4"},L={class:"col-12"},S={class:"border rounded-4 p-5 text-center"},F=e("h5",{class:"fs-4"},"累積產生的便當數",-1),I={class:"mb-0",style:{"font-size":"8rem","line-height":"0.8"}},z={class:"col-lg-6"},B={class:"border rounded-4 p-5 h-100"},U=e("h5",{class:"mb-4 fs-4"},"會員資料",-1),q={class:"form-floating mb-4"},E=["value"],M=e("label",null,"帳號",-1),N={class:"form-floating mb-4"},j={key:0,class:"text-danger mb-0 mt-2",style:{"font-size":"0.875rem"}},A=e("label",{for:"username"},"暱稱",-1),T=e("div",{class:"text-end mt-4"},[e("button",{type:"submit",class:"btn btn-primary btn-lg rounded-pill"},"修改資料")],-1),G={class:"col-lg-6"},H={class:"border rounded-4 p-5 h-100"},J=e("h5",{class:"mb-4 fs-4"},"修改密碼",-1),K={class:"form-floating mb-4"},O=e("label",{for:"oldPassword"},"請輸入舊密碼",-1),Q={class:"form-floating mb-4"},R=e("label",{for:"newPassword"},"請輸入新密碼",-1),W={class:"form-floating mb-4"},X=e("label",{for:"newPasswordDoubleCheck"},"再次確認新密碼",-1),Y=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-primary btn-lg rounded-pill"},"修改密碼")],-1);function Z(a,s,$,ee,t,n){const b=c("loadingVue"),d=c("VField"),r=c("ErrorMessage"),_=c("VForm");return h(),u(V,null,[o(b,{active:t.isLoading},null,8,["active"]),e("div",P,[e("div",x,[C,n.user.email?(h(),u("div",D,[e("div",L,[e("div",S,[F,e("p",I,k(t.dinnerCount),1)])]),e("div",z,[e("div",B,[U,e("div",q,[e("input",{type:"email",class:"form-control",value:n.user.email,disabled:"",title:"會員帳號不得修改"},null,8,E),M]),o(_,{onSubmit:n.editProfile},{default:f(({errors:l})=>[e("div",N,[o(d,{type:"text",id:"username",placeholder:"暱稱",name:"暱稱",class:m(["form-control",{"is-invalid":l.暱稱||t.renameInvalid}]),rules:"required",modelValue:n.user.nickname,"onUpdate:modelValue":s[0]||(s[0]=i=>n.user.nickname=i),onInput:s[1]||(s[1]=i=>t.renameInvalid=!1)},null,8,["class","modelValue"]),o(r,{name:"暱稱",class:"invalid-feedback",style:{"font-size":"0.875rem"}}),t.renameInvalid?(h(),u("p",j,"新名稱與舊名稱相同")):p("",!0),A]),T]),_:1},8,["onSubmit"])])]),e("div",G,[e("div",H,[J,o(_,{onSubmit:n.changePassword},{default:f(({errors:l})=>[e("div",K,[o(d,{type:"password",id:"oldPassword",placeholder:"請輸入舊密碼",name:"舊密碼",class:m(["form-control",{"is-invalid":l.舊密碼}]),rules:"required",modelValue:t.password.old,"onUpdate:modelValue":s[2]||(s[2]=i=>t.password.old=i)},null,8,["class","modelValue"]),o(r,{name:"舊密碼",class:"invalid-feedback"}),O]),e("div",Q,[o(d,{type:"password",id:"newPassword",placeholder:"請輸入新密碼",name:"新密碼",class:m(["form-control",{"is-invalid":l.新密碼}]),rules:"min:4|is_not:@舊密碼",modelValue:t.password.new,"onUpdate:modelValue":s[3]||(s[3]=i=>t.password.new=i)},null,8,["class","modelValue"]),o(r,{name:"新密碼",class:"invalid-feedback"}),R]),e("div",W,[o(d,{type:"password",id:"newPasswordDoubleCheck",placeholder:"再次確認新密碼",name:"確認新密碼",class:m(["form-control",{"is-invalid":l.確認新密碼}]),rules:"required|confirmed:@新密碼",modelValue:t.password.doubleCheck,"onUpdate:modelValue":s[4]||(s[4]=i=>t.password.doubleCheck=i)},null,8,["class","modelValue"]),o(r,{name:"確認新密碼",class:"invalid-feedback"}),X]),Y]),_:1},8,["onSubmit"])])])])):p("",!0)])])],64)}const oe=v(y,[["render",Z]]);export{oe as default};
