import{_ as T,B as b,j as v,m as M,c as n,b as i,a as e,w as m,F as f,k as q,r as p,o as a,f as y,h as g,g as I,t as k,i as _,l as D,x as A,p as B,e as E}from"./index-Blz8PX25.js";import{d as z,h as N}from"./index-Cood-ub7.js";const O={data(){return{portionOptions:[0,.25,.5,.75,1,1.25,1.5,1.75,2,2.25,2.5,2.75,3,3.25,3.5,3.75,4,4.25,4.5,4.75,5],item:{title:"",engTitle:"",category:"",healthLevel:"",starchPortion:"",proteinPortion:"",vegetablePortion:"",imgUrl:"",images:[],noBgImg:""},tempImg1:"",tempImg2:"",errorMsg:"",isLoading:!1}},components:{DeleteFilled:z,ElSelect:N},methods:{uploadImg(){const r=document.querySelector("#upload-image"),s=document.querySelector("#file-input"),V=new FormData(r);if(s.value){this.isLoading=!0;const P=document.cookie.replace(/(?:(?:^|.*;\s*)token\s*=\s*([^;]*).*$)|^.*$/,"$1");b.defaults.headers.common.Authorization=P,b.post("https://vue3-course-api.hexschool.io/v2/api/whatstoday2024/admin/upload",V).then(o=>{this.tempImg1=o.data.imageUrl,s.value="",b.defaults.headers.common.Authorization=null}).catch(o=>{v.error(o.data.message),b.defaults.headers.common.Authorization=null}).finally(()=>{this.isLoading=!1})}else alert("請先選擇欲上傳之圖片。")},async addItem(){if(this.item.imgUrl===""){this.errorMsg="主圖為必填";return}this.isLoading=!0;try{const r=await b.post("https://whatstoday2024-8nsu.onrender.com/dishes",this.item);v.success(`成功新增 ${r.data.message.title}`),this.$router.push("/admin/admin-items")}catch(r){v.error(r.data.message)}this.isLoading=!1},reset(){this.item={title:"",engTitle:"",category:"",healthLevel:"",starchPortion:"",proteinPortion:"",vegetablePortion:"",imgUrl:"",images:[],noBgImg:""}},addImage1(){this.item.images.push(this.tempImg1),this.tempImg1=""},addImage2(){this.item.images.push(this.tempImg2),this.tempImg2=""},chooseMainImg(r){this.item.imgUrl=r},deleteImg(r,s){if(s===this.item.imgUrl){v.error("不能刪除當前主圖，若欲刪除請先置換主圖");return}this.item.images.splice(r,1)},...M(q,["checkIsAdmin","getUser"])},watch:{"item.imgUrl":function(){this.errorMsg=""}},async mounted(){document.title="新增菜色",await this.getUser(),this.checkIsAdmin()||(v.error("非管理者無法執行"),this.$router.push("/"))}},l=r=>(B("data-v-46337a3b"),r=r(),E(),r),j={class:"container my-5"},R={class:"text-start mb-4 d-flex justify-content-between border-bottom pb-3"},G=l(()=>e("h3",null,"新增菜色",-1)),H={class:"btn btn-outline-primary me-2"},J={class:"btn btn-outline-brand-blue"},K={class:"p-2 p-lg-3 col-md-6"},Q=l(()=>e("h5",null,"菜色名稱 / 分類 / 健康分數",-1)),W={class:"form-floating mb-4"},X=l(()=>e("label",{for:"title"},"中文名稱*",-1)),Y={class:"form-floating mb-4"},Z=l(()=>e("label",{for:"engTitle"},"英文名稱*",-1)),$={class:"form-floating mb-4"},ee=l(()=>e("option",{value:"主食類"},"主食類",-1)),te=l(()=>e("option",{value:"配菜類"},"配菜類",-1)),oe=l(()=>e("option",{value:"主菜類"},"主菜類",-1)),se=l(()=>e("label",{for:"category"},"分類*",-1)),le={class:"form-floating mb-4"},ie=l(()=>e("option",{value:"1"},"1",-1)),ne=l(()=>e("option",{value:"1.5"},"1.5",-1)),ae=l(()=>e("option",{value:"2"},"2",-1)),re=l(()=>e("option",{value:"2.5"},"2.5",-1)),de=l(()=>e("option",{value:"3"},"3",-1)),me=l(()=>e("option",{value:"3.5"},"3.5",-1)),ce=l(()=>e("option",{value:"4"},"4",-1)),ue=l(()=>e("option",{value:"4.5"},"4.5",-1)),he=l(()=>e("option",{value:"5"},"5",-1)),pe=l(()=>e("label",{for:"healthLevel"},"健康分數*",-1)),ge=l(()=>e("h5",null,"營養比例(份)",-1)),_e={class:"form-floating mb-4"},be=["value"],ve=l(()=>e("label",{for:"starchPortion"},"澱粉比例*",-1)),fe={class:"form-floating mb-4"},ye=["value"],Ie=l(()=>e("label",{for:"proteinPortion"},"蛋白質比例*",-1)),ke={class:"form-floating mb-4"},Ve=["value"],Pe=l(()=>e("label",{for:"vegetablePortion"},"蔬菜比例*",-1)),xe={class:"p-2 p-lg-3 col-md-6"},Ue=l(()=>e("h5",null,"菜色圖片",-1)),we={id:"upload-image",class:"mb-2",action:"/api/whatstoday2024/admin/upload",enctype:"multipart/form-data",method:"post"},Le=l(()=>e("label",{for:"formFile",class:"form-label"},"上傳圖片",-1)),Ce=["src"],Se={class:"form-floating mb-4"},Fe={class:"form-group mb-3"},Te=l(()=>e("label",{for:"imgUrl",class:"form-label"},"圖片網址",-1)),Me=["src"],qe={class:"mb-3"},De=l(()=>e("span",null,"主圖*",-1)),Ae={class:"errorMsg"},Be={key:0},Ee=["src"],ze={"mb-3":""},Ne={key:0,class:"img-box"},Oe=["src"],je=["onClick"],Re=["onClick"],Ge={class:"d-flex gap-2 mt-3 btn-container"},He=l(()=>e("button",{type:"submit",class:"btn btn-brand-blue btn-md mb-4"},"確認",-1));function Je(r,s,V,P,o,d){const C=p("loadingVue"),x=p("RouterLink"),c=p("VField"),u=p("ErrorMessage"),U=p("ElSelect"),w=p("DeleteFilled"),S=p("VForm");return a(),n(f,null,[i(C,{active:o.isLoading},null,8,["active"]),e("div",j,[e("div",R,[G,e("div",null,[e("button",H,[i(x,{class:"navbar-brand",to:"/admin/dashboard"},{default:m(()=>[y(" Dashboard ")]),_:1})]),e("button",J,[i(x,{class:"navbar-brand",to:"/admin/admin-items"},{default:m(()=>[y(" 菜色列表 ")]),_:1})])])]),i(S,{class:"row",onSubmit:d.addItem},{default:m(({errors:h})=>[e("div",K,[e("div",null,[Q,e("div",W,[i(c,{type:"text",id:"title",placeholder:"請輸入菜色名稱",name:"title",class:g(["form-control",{"is-invalid":h.title}]),rules:"required",modelValue:o.item.title,"onUpdate:modelValue":s[0]||(s[0]=t=>o.item.title=t)},null,8,["class","modelValue"]),i(u,{name:"title",class:"invalid-feedback"}),X]),e("div",Y,[i(c,{type:"text",id:"engTitle",placeholder:"請輸入英文名稱",name:"engTitle",class:g(["form-control",{"is-invalid":h.engTitle}]),rules:"required",modelValue:o.item.engTitle,"onUpdate:modelValue":s[1]||(s[1]=t=>o.item.engTitle=t)},null,8,["class","modelValue"]),i(u,{name:"engTitle",class:"invalid-feedback"}),Z]),e("div",$,[i(c,{as:"select",id:"category",placeholder:"請選擇分類",name:"category",class:g(["form-select",{"is-invalid":h.category}]),rules:"required",modelValue:o.item.category,"onUpdate:modelValue":s[2]||(s[2]=t=>o.item.category=t)},{default:m(()=>[ee,te,oe]),_:2},1032,["class","modelValue"]),i(u,{name:"category",class:"invalid-feedback"}),se]),e("div",le,[i(c,{as:"select",id:"healthLevel",placeholder:"請選擇健康分數",name:"healthLevel",class:g(["form-select",{"is-invalid":h.healthLevel}]),rules:"required",modelValue:o.item.healthLevel,"onUpdate:modelValue":s[3]||(s[3]=t=>o.item.healthLevel=t)},{default:m(()=>[ie,ne,ae,re,de,me,ce,ue,he]),_:2},1032,["class","modelValue"]),i(u,{name:"healthLevel",class:"invalid-feedback"}),pe])]),e("div",null,[ge,e("div",_e,[i(c,{as:"select",id:"starchPortion",placeholder:"請選擇澱粉比例",name:"starchPortion",class:g(["form-select",{"is-invalid":h.starchPortion}]),rules:"required",modelValue:o.item.starchPortion,"onUpdate:modelValue":s[4]||(s[4]=t=>o.item.starchPortion=t)},{default:m(()=>[(a(!0),n(f,null,I(o.portionOptions,t=>(a(),n("option",{value:t,key:t},k(t),9,be))),128))]),_:2},1032,["class","modelValue"]),i(u,{name:"starchPortion",class:"invalid-feedback"}),ve]),e("div",fe,[i(c,{as:"select",id:"proteinPortion",placeholder:"請選擇蛋白質比例",name:"proteinPortion",class:g(["form-select",{"is-invalid":h.proteinPortion}]),rules:"required",modelValue:o.item.proteinPortion,"onUpdate:modelValue":s[5]||(s[5]=t=>o.item.proteinPortion=t)},{default:m(()=>[(a(!0),n(f,null,I(o.portionOptions,t=>(a(),n("option",{value:t,key:t},k(t),9,ye))),128))]),_:2},1032,["class","modelValue"]),i(u,{name:"proteinPortion",class:"invalid-feedback"}),Ie]),e("div",ke,[i(c,{as:"select",id:"vegetablePortion",placeholder:"請選擇蔬菜比例",name:"vegetablePortion",class:g(["form-select",{"is-invalid":h.vegetablePortion}]),rules:"required",modelValue:o.item.vegetablePortion,"onUpdate:modelValue":s[6]||(s[6]=t=>o.item.vegetablePortion=t)},{default:m(()=>[(a(!0),n(f,null,I(o.portionOptions,t=>(a(),n("option",{value:t,key:t},k(t),9,Ve))),128))]),_:2},1032,["class","modelValue"]),i(u,{name:"vegetablePortion",class:"invalid-feedback"}),Pe])])]),e("div",xe,[e("div",null,[Ue,e("form",we,[Le,e("input",{ref:"input-file",class:"form-control",type:"file",id:"file-input",name:"file-to-upload",onChange:s[7]||(s[7]=(...t)=>d.uploadImg&&d.uploadImg(...t))},null,544),o.tempImg1!==""?(a(),n("img",{key:0,class:"img",src:o.tempImg1,alt:"image"},null,8,Ce)):_("",!0),o.tempImg1!==""?(a(),n("button",{key:1,type:"button",onClick:s[8]||(s[8]=(...t)=>d.addImage1&&d.addImage1(...t)),class:"mt-2 btn btn-outline-brand-blue btn-sm"},"新增此圖片至圖片列表")):_("",!0)])]),e("div",null,[e("div",Se,[e("div",Fe,[Te,D(e("input",{id:"imgUrl","onUpdate:modelValue":s[9]||(s[9]=t=>o.tempImg2=t),type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,512),[[A,o.tempImg2]]),o.tempImg2!==""?(a(),n("img",{key:0,class:"img",src:o.tempImg2,alt:"image"},null,8,Me)):_("",!0),o.tempImg2!==""?(a(),n("button",{key:1,type:"button",onClick:s[10]||(s[10]=(...t)=>d.addImage2&&d.addImage2(...t)),class:"mt-2 btn btn-outline-brand-blue btn-sm"},"新增此圖片至圖片列表")):_("",!0)])])]),e("div",null,[e("div",qe,[De,e("span",Ae,k(o.errorMsg),1),o.item.imgUrl?(a(),n("div",Be,[e("img",{class:"img",src:o.item.imgUrl,alt:"image"},null,8,Ee)])):_("",!0)]),e("div",ze,[e("span",null,[y("圖片列表(點選"),i(U,{style:{width:"20px",height:"20px",color:"yellow"}}),y("成為主圖 / "),i(w,{style:{width:"20px",height:"20px",color:"black"}}),y("刪除圖片)")]),o.item.images.length?(a(),n("div",Ne,[(a(!0),n(f,null,I(o.item.images,(t,L)=>(a(),n("div",{key:L,style:{position:"relative"}},[e("img",{class:"img",src:t,alt:"image"},null,8,Oe),e("span",{onClick:F=>d.chooseMainImg(t)},[i(U,{style:{width:"20px",height:"20px",color:"yellow",position:"absolute",top:"1",left:"1",cursor:"pointer"}})],8,je),e("span",{onClick:F=>d.deleteImg(L,t)},[i(w,{style:{width:"20px",height:"20px",color:"#d4d4d4",position:"absolute",top:"1",right:"1",cursor:"pointer"}})],8,Re)]))),128))])):_("",!0)])]),e("div",Ge,[He,e("button",{type:"button",onClick:s[11]||(s[11]=(...t)=>d.reset&&d.reset(...t)),class:"btn btn-outline-grey66 btn-md mb-4"},"重置")])])]),_:1},8,["onSubmit"])])],64)}const We=T(O,[["render",Je],["__scopeId","data-v-46337a3b"]]);export{We as default};
